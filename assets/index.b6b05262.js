var se=Object.defineProperty;var ae=(e,t,r)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var $=(e,t,r)=>(ae(e,typeof t!="symbol"?t+"":t,r),r);import{R as L,A as oe,r as h,j as i,C as G,S as R,a as j,F as N,b as U,c as ie,P as ce,t as q,M as le,T as ue,O as de,V as pe,d as fe,e as he,f as me,g as ye,h as V,q as W,i as H,k as xe,l as T,m as Y,n as K,o as ge,p as ve,s as we,u as Ce,v as B,w as Me,x as Q,y as be,z as Z,B as ke,D as Se,E as Ee,G as Pe,H as k,I as Ae,J as De,K as Ie,L as Le,N as X,Q as Oe,U as _,W as A,X as J,Y as $e,Z as Re}from"./vendor.1a62c058.js";const je=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}};je();const z=L.createContext(null),Ne=({children:e})=>{const t="my-city-climate-pqkfg",r=new oe({id:t}),[n,a]=h.exports.useState(null),s=async()=>{const p=G.anonymous();try{return await r.logIn(p),a(r.currentUser),r.currentUser}catch{return a(null),null}},c=async(p,x)=>{const f=G.emailPassword(p,x);try{return await r.logIn(f),a(r.currentUser),r.currentUser}catch{return a(null),null}},y=()=>{var p;n!==null&&((p=r.currentUser)==null||p.logOut(),a(null))};return i(z.Provider,{value:{logIn:c,logOut:y,user:n,anonymousIn:s},children:e})},ee=()=>{const e=h.exports.useContext(z);if(e==null)throw new Error("useRealmApp() called outside of a RealmApp?");return e},te=L.createContext(null),Ue=({children:e})=>{const{user:t}=ee(),[r,n]=h.exports.useState(null);return h.exports.useEffect(()=>{if(t!==null){const a=t.mongoClient("mongodb-atlas");n(a.db("mcc-climate"))}},[t]),i(te.Provider,{value:{db:r},children:e})},ne=()=>{const e=h.exports.useContext(te);if(e==null)throw new Error("useMongoDB() called outside of a MongoDB?");return e};const F={climate:new R({image:new j({radius:8,fill:new N({color:"#FC9292"}),stroke:new U({color:"#C86767",width:1})})}),perception:new R({image:new j({radius:3,fill:new N({color:"#c0ddff"}),stroke:new U({color:"#5f97dc",width:1})})}),synoptic:new R({image:new j({radius:5,fill:new N({color:"#d0ffc0"}),stroke:new U({color:"#74d350",width:1})})})},Te=e=>e.type=="k"?F.climate:e.type=="s"?F.synoptic:e.type=="pp"?F.perception:new R,Be=e=>e=="k"?10:e=="s"?9:(e=="pp",8),Fe=e=>{const t={k:[],s:[],pp:[]};return e.forEach(r=>{const n=new ie({geometry:new ce(q(r.location.coordinates,"EPSG:4326","EPSG:3857")),name:r.name});switch(n.type=r.type,n.setProperties({code:r.code,name:r.name,type:r.type}),r.type){case"k":t.k.push(n);break;case"pp":t.pp.push(n);break;case"s":t.s.push(n);break;default:console.error(`Unknown station type: ${r.type}`)}}),t};function Ge(e){const t=h.exports.useRef(null);return h.exports.useEffect(()=>{const r=new le({target:t.current,layers:[new ue({source:new de})],view:new pe({projection:"EPSG:3857",center:q([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6,extent:fe([11.51284,46.3127,28.18045,58.36571],"EPSG:4326","EPSG:3857")}),controls:he()});e.onMapCreate&&e.onMapCreate(r)},[]),i("div",{ref:t,className:"map-container"})}var qe=L.memo(Ge,(e,t)=>!0);class Ve extends L.Component{constructor(t){super(t);$(this,"map");$(this,"stationsLayer",!1);$(this,"buildStationsLayer",()=>{if(!this.map)return;const t=this.map,r=Fe(this.props.stations);let n;for(n in r){const a=r[n],s=new me({source:new ye({features:a}),style:Te});s.setZIndex(Be(n)),t.addLayer(s),n=="k"&&t.getView().fit(s.getSource().getExtent(),{padding:[50,50,50,50]})}this.stationsLayer=!0,t.on("pointermove",a=>{const s=t.getEventPixel(a.originalEvent),c=t.hasFeatureAtPixel(s);t.getViewport().style.cursor=c?"pointer":""}),t.on("click",a=>{const{onClickFeatures:s}=this.props;if(!s)return;const c=[];t.getEventPixel(a.originalEvent),t.forEachFeatureAtPixel(a.pixel,y=>c.push(y)),s(c)})})}componentDidUpdate(t){t.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(t){this.map=t}render(){return i(qe,{onMapCreate:t=>this.onMapCreate(t)})}}function We(e,{title:t,tickSize:r=6,width:n=320,height:a=44+r,marginTop:s=18,marginRight:c=0,marginBottom:y=16+r,marginLeft:p=0,ticks:x=n/64,tickFormat:f,tickValues:l}={}){function C(u,d=256){const m=document.createElement("canvas");m.width=d,m.height=1;const w=m.getContext("2d");for(let v=0;v<d;++v)w.fillStyle=u(v/(d-1)),w.fillRect(v,0,1,1);return m}const b=V("svg").attr("width",n).attr("height",a).attr("viewBox",[0,0,n,a]).style("overflow","visible").style("display","block");let S=u=>u.selectAll(".tick line").attr("y1",s+y-a),g;if(e.interpolate){const u=Math.min(e.domain().length,e.range().length);g=e.copy().rangeRound(W(H(p,n-c),u)),b.append("image").attr("x",p).attr("y",s).attr("width",n-p-c).attr("height",a-s-y).attr("preserveAspectRatio","none").attr("xlink:href",C(e.copy().domain(W(H(0,1),u))).toDataURL())}else if(e.interpolator){if(g=Object.assign(e.copy().interpolator(xe(p,n-c)),{range(){return[p,n-c]}}),b.append("image").attr("x",p).attr("y",s).attr("width",n-p-c).attr("height",a-s-y).attr("preserveAspectRatio","none").attr("xlink:href",C(e.interpolator()).toDataURL()),!g.ticks){if(l===void 0){const u=Math.round(x+1);l=T(u).map(d=>Y(e.domain(),d/(u-1)))}typeof f!="function"&&(f=K(f===void 0?",f":f))}}else if(e.invertExtent){const u=e.thresholds?e.thresholds():e.quantiles?e.quantiles():e.domain(),d=f===void 0?m=>m:typeof f=="string"?K(f):f;g=ge().domain([-1,e.range().length-1]).rangeRound([p,n-c]),b.append("g").selectAll("rect").data(e.range()).join("rect").attr("x",(m,w)=>g(w-1)).attr("y",s).attr("width",(m,w)=>g(w)-g(w-1)).attr("height",a-s-y).attr("fill",m=>m),l=T(u.length),f=m=>d(u[m],m)}else g=ve().domain(e.domain()).rangeRound([p,n-c]),b.append("g").selectAll("rect").data(e.domain()).join("rect").attr("x",g).attr("y",s).attr("width",Math.max(0,g.bandwidth()-1)).attr("height",a-s-y).attr("fill",e),S=()=>{};return b.append("g").attr("transform",`translate(0,${a-y})`).call(we(g).ticks(x,typeof f=="string"?f:void 0).tickFormat(typeof f=="function"?f:void 0).tickSize(r).tickValues(l)).call(S).call(u=>u.select(".domain").remove()).call(u=>u.append("text").attr("x",p).attr("y",s+y-a-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(t)),b.node()}function He(e,{x:t=([l])=>l,y:r=([,l])=>l,title:n,width:a=1e3,cellSize:s=12,weekday:c="monday",formatDay:y=l=>"SMTWTFS"[l],formatMonth:p="%b",yFormat:x,colors:f=Ce}={}){const l=B(e,t),C=B(e,r),b=T(l.length),S=c==="sunday"?o=>o:o=>(o+6)%7,g=c==="sunday"?Ee:Pe,u=c==="weekday"?5:7,d=s*(u+.2);a=s*58;const m=Y(C,.9975,Math.abs),w=Me([-m,+m],f).unknown("none");if(p=Q(p),n===void 0){const o=Q("%B %-d, %Y"),M=w.tickFormat(100,x);n=E=>`${o(l[E])}
${M(C[E])}`}else if(n!==null){const o=B(e,n);n=M=>o[M]}const v=be(b,o=>l[o].getUTCFullYear()).reverse();function D(o){const M=Math.max(0,Math.min(u,S(o.getUTCDay()))),E=g.count(Z(o),o);return`${M===0?`M${E*s},0`:M===u?`M${(E+1)*s},0`:`M${(E+1)*s},0V${M*s}H${E*s}`}V${u*s}`}const O=V("svg").attr("width",a).attr("height",d*v.length).attr("viewBox",[0,0,a,d*v.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size","14px"),I=O.selectAll("g").data(v).join("g").attr("id",(o,M)=>`mcc-year-${o[0]}`).attr("transform",(o,M)=>`translate(40.5,${d*M+s*1.5})`);I.append("text").attr("x",-5).attr("y",s*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([o])=>o);const re=I.append("g").selectAll("rect").data(c==="weekday"?([,o])=>o.filter(M=>![0,6].includes(l[M].getUTCDay())):([,o])=>o).join("rect").attr("width",s-1).attr("height",s-1).attr("x",o=>g.count(Z(l[o]),l[o])*s+.5).attr("y",o=>S(l[o].getUTCDay())*s+.5).attr("fill",o=>w(C[o]));return n&&re.append("title").text(n),I.append("g").selectAll("g").data(([,o])=>ke(Se(l[o[0]]),l[o[o.length-1]])).join("g").filter((o,M)=>M).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",D),Object.assign(O.node(),{scales:{color:w}})}const Ye=e=>{if(e.length==0)return[];const t=e[0],r=[];let n;for(n in t)switch(n){case"tavg":r.push({key:n,name:"Average Air Temperature, \xB0C"});break;case"tmax":r.push({key:n,name:"Maximum Air Temperature, \xB0C"});break;case"tmin":r.push({key:n,name:"Minimum Air Temperature, \xB0C"});break;case"precip":r.push({key:n,name:"Precipitation, mm"});break;case"snowd":r.push({key:n,name:"Snow Depth, mm"});break}return r},Ke=i(X,{sx:{width:"100%",marginTop:"10%"},children:i(Oe,{})});let P=null;function Qe(e){const{station:t,className:r}=e,[n,a]=h.exports.useState(""),[s,c]=h.exports.useState([]),[y,p]=h.exports.useState([]),x=h.exports.useRef(!0),{db:f}=ne(),l=h.exports.useRef(null),C=h.exports.useRef(null),b=d=>{a(d.target.value)};h.exports.useEffect(()=>()=>{x.current=!1,P&&window.removeEventListener("resize",P),P=null},[]),h.exports.useEffect(()=>{async function d(){if(!t)return;const m=t.getProperties();if(!m.hasOwnProperty("code"))return;const w=m.code;if(f){const v=await f.collection("observations").find({"source.code":parseInt(w,10)},{sort:{ts:-1}}),D=Ye(v).sort((O,I)=>O.name>I.name?1:-1);x.current&&(c(D),a(D.length>0?D[0].key:""),p(v))}}d()},[f]),h.exports.useEffect(()=>{y.length>0&&n!=""&&(g(),S())},[y,n]);const S=()=>{let d;P&&window.removeEventListener("resize",P),P=()=>{clearTimeout(d),d=setTimeout(g,500)},window.addEventListener("resize",P)},g=()=>{var w;if(y.length==0||!l||!l.current||!C||!C.current)return;const d=He(y,{x:v=>v.ts,y:v=>v[n],cellSize:C.current.clientWidth/60,width:C.current.clientWidth-100});C.current.innerHTML="",C.current.appendChild(d);const m=We(d.scales.color,{title:(w=s.find(v=>v.key==n))==null?void 0:w.name,tickFormat:".0f"});l.current.innerHTML="",l.current.appendChild(m)};let u;return y.length==0?u=Ke:u=k("div",{className:"grid",children:[i("div",{className:"controls",children:k(Ae,{sx:{minWidth:200},size:"small",children:[i(De,{id:"demo-simple-select-label",children:"Indicator"}),i(Ie,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:n,label:"Indicator",onChange:b,children:s.map(d=>i(Le,{value:d.key,children:d.name},d.key))})]})}),i("div",{className:"legend",ref:l}),i("div",{className:"calendar",ref:C})]}),i("div",{className:r,children:u})}function Ze(e){const{station:t,onClose:r}=e,n=()=>r();let a=i($e,{});return t&&(a=i(_,{open:!0,onClose:n,children:k("div",{className:"station-modal",children:[k("div",{className:"header",children:[i(A,{variant:"h6",children:t.getProperties().name}),i(J,{onClick:n,variant:"outlined",children:"Close"})]}),i(Qe,{className:"wrapper",station:t})]})})),a}var Xe="/mcc-frontend/assets/favicon.27019856.svg";function _e(){const[e,t]=h.exports.useState(!1),r=()=>t(!0),n=()=>t(!1);return k(h.exports.Fragment,{children:[i("div",{className:"logo",title:"My city's climate",onClick:r,children:i("img",{src:Xe,alt:"My city's climate"})}),i(_,{open:e,onClose:n,children:k(X,{className:"modal-logo-description",children:[i(A,{variant:"h6",component:"h2",children:"My city's climate"}),i(A,{sx:{mt:2},children:"Free online viewer for historical weather data"}),k(A,{sx:{mt:2},children:["The application uses ",i("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),k(A,{sx:{mt:2},children:["Source code - ",i("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),i(A,{align:"right",sx:{mt:2},children:i(J,{onClick:n,variant:"outlined",children:"Close"})})]})})]})}function Je(){const{anonymousIn:e,user:t}=ee(),{db:r}=ne(),[n,a]=h.exports.useState([]),[s,c]=h.exports.useState(null);h.exports.useEffect(()=>{async function x(){if(r){const f=await r.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});a(f)}}x()},[r]),h.exports.useEffect(()=>{t||e()});const y=x=>{x.length!=0&&c(x[0])},p=()=>{c(null)};return k(h.exports.Fragment,{children:[k("div",{className:"app",children:[i(_e,{}),i(Ve,{stations:n,onClickFeatures:x=>y(x)})]}),i(Ze,{station:s,onClose:p})]})}Re.render(i(L.StrictMode,{children:i(Ne,{children:i(Ue,{children:i(Je,{})})})}),document.getElementById("root"));
