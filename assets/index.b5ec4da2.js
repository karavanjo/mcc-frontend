var Z=Object.defineProperty;var z=(n,t,e)=>t in n?Z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var C=(n,t,e)=>(z(n,typeof t!="symbol"?t+"":t,e),e);import{R as x,A as tt,r as d,j as i,C as R,S as M,a as F,F as O,b as D,c as et,P as nt,t as U,M as ot,T as rt,O as st,V as at,d as it,e as ct,f as lt,m as L,g as ut,q as dt,s as pt,u as I,h as ft,i as ht,k as V,l as mt,n as gt,o as yt,p as wt,v as m,B as G,w as $,x as q,y as w,z as W,D as xt,E as vt}from"./vendor.0264719b.js";const Ct=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}};Ct();const Y=x.createContext(null),Mt=({children:n})=>{const t="my-city-climate-pqkfg",e=new tt({id:t}),[s,o]=d.exports.useState(null),r=async()=>{const p=R.anonymous();try{return await e.logIn(p),o(e.currentUser),e.currentUser}catch{return o(null),null}},c=async(p,l)=>{const g=R.emailPassword(p,l);try{return await e.logIn(g),o(e.currentUser),e.currentUser}catch{return o(null),null}},h=()=>{var p;s!==null&&((p=e.currentUser)==null||p.logOut(),o(null))};return i(Y.Provider,{value:{logIn:c,logOut:h,user:s,anonymousIn:r},children:n})},Q=()=>{const n=d.exports.useContext(Y);if(n==null)throw new Error("useRealmApp() called outside of a RealmApp?");return n},_=x.createContext(null),St=({children:n})=>{const{user:t}=Q(),[e,s]=d.exports.useState(null);return d.exports.useEffect(()=>{if(t!==null){const o=t.mongoClient("mongodb-atlas");s(o.db("mcc-climate"))}},[t]),i(_.Provider,{value:{db:e},children:n})},H=()=>{const n=d.exports.useContext(_);if(n==null)throw new Error("useMongoDB() called outside of a MongoDB?");return n};const A={climate:new M({image:new F({radius:8,fill:new O({color:"#FC9292"}),stroke:new D({color:"#C86767",width:1})})}),perception:new M({image:new F({radius:3,fill:new O({color:"#c0ddff"}),stroke:new D({color:"#5f97dc",width:1})})}),synoptic:new M({image:new F({radius:5,fill:new O({color:"#d0ffc0"}),stroke:new D({color:"#74d350",width:1})})})},bt=n=>n.type=="k"?A.climate:n.type=="s"?A.synoptic:n.type=="pp"?A.perception:new M,Et=n=>{const t=[];return n.forEach(e=>{const s=new et({geometry:new nt(U(e.location.coordinates,"EPSG:4326","EPSG:3857")),name:e.name});s.type=e.type,s.setProperties({code:e.code,name:e.name,type:e.type}),t.push(s)}),t};function Pt(n){const t=d.exports.useRef(null);return d.exports.useEffect(()=>{const e=new ot({target:t.current,layers:[new rt({source:new st})],view:new at({projection:"EPSG:3857",center:U([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6}),controls:[]});n.onMapCreate&&n.onMapCreate(e)},[]),i("div",{ref:t,className:"map-container"})}var kt=x.memo(Pt,(n,t)=>!0);class Ft extends x.Component{constructor(t){super(t);C(this,"map");C(this,"stationsLayer");C(this,"buildStationsLayer",()=>{if(!this.map)return;const t=this.map,e=Et(this.props.stations),s=new it({source:new ct({features:e}),style:bt});t.addLayer(s),t.getView().fit(s.getSource().getExtent(),{padding:[50,50,50,50]}),t.on("pointermove",o=>{const r=t.getEventPixel(o.originalEvent),c=t.hasFeatureAtPixel(r);t.getViewport().style.cursor=c?"pointer":""}),t.on("click",o=>{const{onClickFeatures:r}=this.props;if(!r)return;const c=[];t.getEventPixel(o.originalEvent),t.forEachFeatureAtPixel(o.pixel,h=>c.push(h)),r(c)}),this.stationsLayer=s})}componentDidUpdate(t){t.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(t){this.map=t}render(){return i(kt,{onMapCreate:t=>this.onMapCreate(t)})}}function Ot(n,{x:t=([u])=>u,y:e=([,u])=>u,title:s,width:o=1e3,cellSize:r=12,weekday:c="monday",formatDay:h=u=>"SMTWTFS"[u],formatMonth:p="%b",yFormat:l,colors:g=lt}={}){const u=L(n,t),S=L(n,e),K=ut(u.length),T=c==="sunday"?a=>a:a=>(a+6)%7,j=c==="sunday"?yt:wt,v=c==="weekday"?5:7,b=r*(v+.2),B=dt(S,.9975,Math.abs),E=pt([-B,+B],g).unknown("none");if(p=I(p),s===void 0){const a=I("%B %-d, %Y"),f=E.tickFormat(100,l);s=y=>`${a(u[y])}
${f(S[y])}`}else if(s!==null){const a=L(n,s);s=f=>a[f]}const P=ft(K,a=>u[a].getUTCFullYear()).reverse();function X(a){const f=Math.max(0,Math.min(v,T(a.getUTCDay()))),y=j.count(V(a),a);return`${f===0?`M${y*r},0`:f===v?`M${(y+1)*r},0`:`M${(y+1)*r},0V${f*r}H${y*r}`}V${v*r}`}const N=ht("svg").attr("width",o).attr("height",b*P.length).attr("viewBox",[0,0,o,b*P.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size",15),k=N.selectAll("g").data(P).join("g").attr("id",(a,f)=>`mcc-year-${a[0]}`).attr("transform",(a,f)=>`translate(40.5,${b*f+r*1.5})`);k.append("text").attr("x",-5).attr("y",r*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([a])=>a);const J=k.append("g").selectAll("rect").data(c==="weekday"?([,a])=>a.filter(f=>![0,6].includes(u[f].getUTCDay())):([,a])=>a).join("rect").attr("width",r-1).attr("height",r-1).attr("x",a=>j.count(V(u[a]),u[a])*r+.5).attr("y",a=>T(u[a].getUTCDay())*r+.5).attr("fill",a=>E(S[a]));return s&&J.append("title").text(s),k.append("g").selectAll("g").data(([,a])=>mt(gt(u[a[0]]),u[a[a.length-1]])).join("g").filter((a,f)=>f).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",X),Object.assign(N.node(),{scales:{color:E}})}const Dt=m(G,{sx:{width:"100%"},children:[i($,{}),i($,{animation:"wave"}),i($,{animation:!1})]});function Lt(n){const{station:t,className:e}=n,[s,o]=d.exports.useState([]),{db:r}=H(),c=d.exports.useRef(null);d.exports.useEffect(()=>{if(s.length==0||!c||!c.current)return;const p=Ot(s,{x:l=>l.ts,y:l=>l.tavg,cellSize:c.current.clientWidth/60,width:c.current.clientWidth-100});c.current&&c.current.appendChild(p)},[s]),d.exports.useEffect(()=>{async function p(){if(!t)return;const l=t.getProperties();if(!l.hasOwnProperty("code"))return;const g=l.code;if(r){const u=await r.collection("observations").find({"source.code":parseInt(g,10)},{sort:{ts:-1}});o(u)}}p()},[r]);let h;return s.length==0?h=Dt:h=i("div",{className:"grid",ref:c}),i("div",{className:e,children:h})}function $t(n){const{station:t,onClose:e}=n,s=()=>e();let o=i(xt,{});return t&&(o=i(q,{open:!0,onClose:s,children:m("div",{className:"station-modal",children:[m("div",{className:"header",children:[i(w,{variant:"h3",component:"h3",children:t.getProperties().name}),i(W,{onClick:s,variant:"outlined",children:"Close"})]}),i(Lt,{className:"wrapper",station:t})]})})),o}var At="/mcc-frontend/assets/favicon.27019856.svg";function Tt(){const[n,t]=d.exports.useState(!1),e=()=>t(!0),s=()=>t(!1);return m(d.exports.Fragment,{children:[i("div",{className:"logo",title:"My city's climate",onClick:e,children:i("img",{src:At,alt:"My city's climate"})}),i(q,{open:n,onClose:s,children:m(G,{className:"modal-logo-description",children:[i(w,{variant:"h6",component:"h2",children:"My city's climate"}),i(w,{sx:{mt:2},children:"Free online viewer for historical weather data"}),m(w,{sx:{mt:2},children:["The application uses ",i("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),m(w,{sx:{mt:2},children:["Source code - ",i("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),i(w,{align:"right",sx:{mt:2},children:i(W,{onClick:s,variant:"outlined",children:"Close"})})]})})]})}function jt(){const{anonymousIn:n,user:t}=Q(),{db:e}=H(),[s,o]=d.exports.useState([]),[r,c]=d.exports.useState(null);d.exports.useEffect(()=>{async function l(){if(e){const g=await e.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});o(g)}}l()},[e]),d.exports.useEffect(()=>{t||n()});const h=l=>{l.length!=0&&c(l[0])},p=()=>{c(null)};return m(d.exports.Fragment,{children:[m("div",{className:"app",children:[i(Tt,{}),i(Ft,{stations:s,onClickFeatures:l=>h(l)})]}),i($t,{station:r,onClose:p})]})}vt.render(i(x.StrictMode,{children:i(Mt,{children:i(St,{children:i(jt,{})})})}),document.getElementById("root"));
