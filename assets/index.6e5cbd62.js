var se=Object.defineProperty;var ae=(e,t,r)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var $=(e,t,r)=>(ae(e,typeof t!="symbol"?t+"":t,r),r);import{R as L,A as oe,r as m,j as o,C as q,S as O,a as N,F as U,b as G,c as ie,P as ce,t as H,M as le,T as de,O as ue,V as pe,d as fe,e as he,f as me,g as ye,h as V,q as W,i as Y,k as ge,l as B,m as _,n as K,o as xe,p as ve,s as we,u as R,v as T,w as Ce,x as be,y as Me,z as Q,B as ke,D as Z,E as Se,G as Ee,H as Pe,I as Ae,J as De,K as Ie,L as M,N as Le,Q as $e,U as Oe,W as Re,X,Y as je,Z as J,_ as P,$ as z,a0 as Ne,a1 as Ue}from"./vendor.40ceb83f.js";const Ge=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}};Ge();const ee=L.createContext(null),Be=({children:e})=>{const t="my-city-climate-pqkfg",r=new oe({id:t}),[n,a]=m.exports.useState(null),s=async()=>{const p=q.anonymous();try{return await r.logIn(p),a(r.currentUser),r.currentUser}catch{return a(null),null}},c=async(p,g)=>{const f=q.emailPassword(p,g);try{return await r.logIn(f),a(r.currentUser),r.currentUser}catch{return a(null),null}},y=()=>{var p;n!==null&&((p=r.currentUser)==null||p.logOut(),a(null))};return o(ee.Provider,{value:{logIn:c,logOut:y,user:n,anonymousIn:s},children:e})},te=()=>{const e=m.exports.useContext(ee);if(e==null)throw new Error("useRealmApp() called outside of a RealmApp?");return e},ne=L.createContext(null),Te=({children:e})=>{const{user:t}=te(),[r,n]=m.exports.useState(null);return m.exports.useEffect(()=>{if(t!==null){const a=t.mongoClient("mongodb-atlas");n(a.db("mcc-climate"))}},[t]),o(ne.Provider,{value:{db:r},children:e})},re=()=>{const e=m.exports.useContext(ne);if(e==null)throw new Error("useMongoDB() called outside of a MongoDB?");return e};const F={climate:new O({image:new N({radius:8,fill:new U({color:"#FC9292"}),stroke:new G({color:"#C86767",width:1})})}),perception:new O({image:new N({radius:3,fill:new U({color:"#c0ddff"}),stroke:new G({color:"#5f97dc",width:1})})}),synoptic:new O({image:new N({radius:5,fill:new U({color:"#d0ffc0"}),stroke:new G({color:"#74d350",width:1})})})},Fe=e=>e.type=="k"?F.climate:e.type=="s"?F.synoptic:e.type=="pp"?F.perception:new O,qe=e=>e=="k"?10:e=="s"?9:(e=="pp",8),He=e=>{const t={k:[],s:[],pp:[]};return e.forEach(r=>{const n=new ie({geometry:new ce(H(r.location.coordinates,"EPSG:4326","EPSG:3857")),name:r.name});switch(n.type=r.type,n.setProperties({code:r.code,name:r.name,type:r.type}),r.type){case"k":t.k.push(n);break;case"pp":t.pp.push(n);break;case"s":t.s.push(n);break;default:console.error(`Unknown station type: ${r.type}`)}}),t};function Ve(e){const t=m.exports.useRef(null);return m.exports.useEffect(()=>{const r=new le({target:t.current,layers:[new de({source:new ue})],view:new pe({projection:"EPSG:3857",center:H([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6,extent:fe([11.51284,46.3127,28.18045,58.36571],"EPSG:4326","EPSG:3857")}),controls:he()});e.onMapCreate&&e.onMapCreate(r)},[]),o("div",{ref:t,className:"map-container"})}var We=L.memo(Ve,(e,t)=>!0);class Ye extends L.Component{constructor(t){super(t);$(this,"map");$(this,"stationsLayer",!1);$(this,"buildStationsLayer",()=>{if(!this.map)return;const t=this.map,r=He(this.props.stations);let n;for(n in r){const a=r[n],s=new me({source:new ye({features:a}),style:Fe});s.setZIndex(qe(n)),t.addLayer(s),n=="k"&&t.getView().fit(s.getSource().getExtent(),{padding:[50,50,50,50]})}this.stationsLayer=!0,t.on("pointermove",a=>{const s=t.getEventPixel(a.originalEvent),c=t.hasFeatureAtPixel(s);t.getViewport().style.cursor=c?"pointer":""}),t.on("click",a=>{const{onClickFeatures:s}=this.props;if(!s)return;const c=[];t.getEventPixel(a.originalEvent),t.forEachFeatureAtPixel(a.pixel,y=>c.push(y)),s(c)})})}componentDidUpdate(t){t.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(t){this.map=t}render(){return o(We,{onMapCreate:t=>this.onMapCreate(t)})}}function _e(e,{title:t,tickSize:r=6,width:n=320,height:a=44+r,marginTop:s=18,marginRight:c=0,marginBottom:y=16+r,marginLeft:p=0,ticks:g=n/64,tickFormat:f,tickValues:l}={}){function v(u,d=256){const h=document.createElement("canvas");h.width=d,h.height=1;const w=h.getContext("2d");for(let C=0;C<d;++C)w.fillStyle=u(C/(d-1)),w.fillRect(C,0,1,1);return h}const k=V("svg").attr("width",n).attr("height",a).attr("viewBox",[0,0,n,a]).style("overflow","visible").style("display","block");let S=u=>u.selectAll(".tick line").attr("y1",s+y-a),x;if(e.interpolate){const u=Math.min(e.domain().length,e.range().length);x=e.copy().rangeRound(W(Y(p,n-c),u)),k.append("image").attr("x",p).attr("y",s).attr("width",n-p-c).attr("height",a-s-y).attr("preserveAspectRatio","none").attr("xlink:href",v(e.copy().domain(W(Y(0,1),u))).toDataURL())}else if(e.interpolator){if(x=Object.assign(e.copy().interpolator(ge(p,n-c)),{range(){return[p,n-c]}}),k.append("image").attr("x",p).attr("y",s).attr("width",n-p-c).attr("height",a-s-y).attr("preserveAspectRatio","none").attr("xlink:href",v(e.interpolator()).toDataURL()),!x.ticks){if(l===void 0){const u=Math.round(g+1);l=B(u).map(d=>_(e.domain(),d/(u-1)))}typeof f!="function"&&(f=K(f===void 0?",f":f))}}else if(e.invertExtent){const u=e.thresholds?e.thresholds():e.quantiles?e.quantiles():e.domain(),d=f===void 0?h=>h:typeof f=="string"?K(f):f;x=xe().domain([-1,e.range().length-1]).rangeRound([p,n-c]),k.append("g").selectAll("rect").data(e.range()).join("rect").attr("x",(h,w)=>x(w-1)).attr("y",s).attr("width",(h,w)=>x(w)-x(w-1)).attr("height",a-s-y).attr("fill",h=>h),l=B(u.length),f=h=>d(u[h],h)}else x=ve().domain(e.domain()).rangeRound([p,n-c]),k.append("g").selectAll("rect").data(e.domain()).join("rect").attr("x",x).attr("y",s).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",a-s-y).attr("fill",e),S=()=>{};return k.append("g").attr("transform",`translate(0,${a-y})`).call(we(x).ticks(g,typeof f=="string"?f:void 0).tickFormat(typeof f=="function"?f:void 0).tickSize(r).tickValues(l)).call(S).call(u=>u.select(".domain").remove()).call(u=>u.append("text").attr("x",p).attr("y",s+y-a-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(t)),k.node()}function Ke(e,{x:t=([l])=>l,y:r=([,l])=>l,title:n,width:a=1e3,cellSize:s=12,weekday:c="monday",formatDay:y=l=>"SMTWTFS"[l],formatMonth:p="%b",yFormat:g,colors:f=R}={}){const l=T(e,t),v=T(e,r),k=B(l.length),S=c==="sunday"?i=>i:i=>(i+6)%7,x=c==="sunday"?Pe:Ae,u=c==="weekday"?5:7,d=s*(u+.2);a=s*58,_(v,.9975,Math.abs);const h=Ce([be(v),Me(v)],f).unknown("none");if(p=Q(p),n===void 0){const i=Q("%B %-d, %Y"),b=h.tickFormat(100,g);n=E=>`${i(l[E])}
${b(v[E])}`}else if(n!==null){const i=T(e,n);n=b=>i[b]}const w=ke(k,i=>l[i].getUTCFullYear()).reverse();function C(i){const b=Math.max(0,Math.min(u,S(i.getUTCDay()))),E=x.count(Z(i),i);return`${b===0?`M${E*s},0`:b===u?`M${(E+1)*s},0`:`M${(E+1)*s},0V${b*s}H${E*s}`}V${u*s}`}const D=V("svg").attr("width",a).attr("height",d*w.length).attr("viewBox",[0,0,a,d*w.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size","14px"),I=D.selectAll("g").data(w).join("g").attr("id",(i,b)=>`mcc-year-${i[0]}`).attr("transform",(i,b)=>`translate(40.5,${d*b+s*1.5})`);I.append("text").attr("x",-5).attr("y",s*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([i])=>i);const j=I.append("g").selectAll("rect").data(c==="weekday"?([,i])=>i.filter(b=>![0,6].includes(l[b].getUTCDay())):([,i])=>i).join("rect").attr("width",s-1).attr("height",s-1).attr("x",i=>x.count(Z(l[i]),l[i])*s+.5).attr("y",i=>S(l[i].getUTCDay())*s+.5).attr("fill",i=>h(v[i]));return n&&j.append("title").text(n),I.append("g").selectAll("g").data(([,i])=>Se(Ee(l[i[0]]),l[i[i.length-1]])).join("g").filter((i,b)=>b).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",C),Object.assign(D.node(),{scales:{color:h}})}const Qe=e=>{if(e.length==0)return[];const t=e[0],r=[];let n;for(n in t)switch(n){case"tavg":r.push({key:n,name:"Average Air Temperature, \xB0C",colorsScheme:R});break;case"tmax":r.push({key:n,name:"Maximum Air Temperature, \xB0C",colorsScheme:R});break;case"tmin":r.push({key:n,name:"Minimum Air Temperature, \xB0C",colorsScheme:R});break;case"precip":r.push({key:n,name:"Precipitation, mm",colorsScheme:Ie});break;case"snowd":r.push({key:n,name:"Snow Depth, mm",colorsScheme:De});break}return r},Ze=o(X,{sx:{width:"100%",marginTop:"10%"},children:o(je,{})});let A=null;function Xe(e){const{station:t,className:r}=e,[n,a]=m.exports.useState(""),[s,c]=m.exports.useState([]),[y,p]=m.exports.useState([]),g=m.exports.useRef(!0),{db:f}=re(),l=m.exports.useRef(null),v=m.exports.useRef(null),k=d=>{a(d.target.value)};m.exports.useEffect(()=>()=>{g.current=!1,A&&window.removeEventListener("resize",A),A=null},[]),m.exports.useEffect(()=>{async function d(){if(!t)return;const h=t.getProperties();if(!h.hasOwnProperty("code"))return;const w=h.code;if(f){const C=await f.collection("observations").find({"source.code":parseInt(w,10)},{sort:{ts:-1}}),D=Qe(C).sort((I,j)=>I.name>j.name?1:-1);g.current&&(c(D),a(D.length>0?D[0].key:""),p(C))}}d()},[f]),m.exports.useEffect(()=>{y.length>0&&n!=""&&(x(),S())},[y,n]);const S=()=>{let d;A&&window.removeEventListener("resize",A),A=()=>{clearTimeout(d),d=setTimeout(x,500)},window.addEventListener("resize",A)},x=()=>{if(y.length==0||!l||!l.current||!v||!v.current)return;const d=s.find(C=>C.key==n);if(!d)return;const h=Ke(y,{x:C=>C.ts,y:C=>C[n],cellSize:v.current.clientWidth/60,width:v.current.clientWidth-100,colors:d.colorsScheme});v.current.innerHTML="",v.current.appendChild(h);const w=_e(h.scales.color,{title:d.name,tickFormat:".0f"});l.current.innerHTML="",l.current.appendChild(w)};let u;return y.length==0?u=Ze:u=M("div",{className:"grid",children:[o("div",{className:"controls",children:M(Le,{sx:{minWidth:200},size:"small",children:[o($e,{id:"demo-simple-select-label",children:"Indicator"}),o(Oe,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:n,label:"Indicator",onChange:k,children:s.map(d=>o(Re,{value:d.key,children:d.name},d.key))})]})}),o("div",{className:"legend",ref:l}),o("div",{className:"calendar",ref:v})]}),o("div",{className:r,children:u})}function Je(e){const{station:t,onClose:r}=e,n=()=>r();let a=o(Ne,{});return t&&(a=o(J,{open:!0,onClose:n,children:M("div",{className:"station-modal",children:[M("div",{className:"header",children:[o(P,{variant:"h6",children:t.getProperties().name}),o(z,{onClick:n,variant:"outlined",children:"Close"})]}),o(Xe,{className:"wrapper",station:t})]})})),a}var ze="/mcc-frontend/assets/favicon.27019856.svg";function et(){const[e,t]=m.exports.useState(!1),r=()=>t(!0),n=()=>t(!1);return M(m.exports.Fragment,{children:[o("div",{className:"logo",title:"My city's climate",onClick:r,children:o("img",{src:ze,alt:"My city's climate"})}),o(J,{open:e,onClose:n,children:M(X,{className:"modal-logo-description",children:[o(P,{variant:"h6",component:"h2",children:"My city's climate"}),o(P,{sx:{mt:2},children:"Historical weather data viewer for polish cities"}),M(P,{sx:{mt:2},children:["The application uses ",o("a",{href:"https://danepubliczne.imgw.pl/",target:"_blank",title:"Dane publiczne IMGW-PIB",children:"Dane publiczne IMGW-PIB"})]}),M(P,{sx:{mt:2},children:["Source code - ",o("a",{href:"https://github.com/karavanjo/mcc-frontend",target:"_blank",title:"karavanjo/mcc-frontend",children:"GitHub repo"})]}),M(P,{sx:{mt:2},children:["Article on ",o("a",{href:"https://dev.to/karavanjo/my-citys-climate-historical-weather-data-viewer-1mcm",target:"_blank",title:"My city's climate - historical weather data viewer",children:"DEV Community"})]}),o(P,{align:"right",sx:{mt:2},children:o(z,{onClick:n,variant:"outlined",children:"Close"})})]})})]})}function tt(){const{anonymousIn:e,user:t}=te(),{db:r}=re(),[n,a]=m.exports.useState([]),[s,c]=m.exports.useState(null);m.exports.useEffect(()=>{async function g(){if(r){const f=await r.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});a(f)}}g()},[r]),m.exports.useEffect(()=>{t||e()});const y=g=>{g.length!=0&&c(g[0])},p=()=>{c(null)};return M(m.exports.Fragment,{children:[M("div",{className:"app",children:[o(et,{}),o(Ye,{stations:n,onClickFeatures:g=>y(g)})]}),o(Je,{station:s,onClose:p})]})}Ue.render(o(L.StrictMode,{children:o(Be,{children:o(Te,{children:o(tt,{})})})}),document.getElementById("root"));
