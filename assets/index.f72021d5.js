var st=Object.defineProperty;var rt=(t,e,a)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var k=(t,e,a)=>(rt(t,typeof e!="symbol"?e+"":e,a),a);import{R as D,A as at,r as h,j as l,C as F,S as O,a as j,F as L,b as R,c as ot,P as it,t as q,M as ct,T as lt,O as ut,V as dt,d as pt,e as ft,f as ht,g as yt,h as B,q as V,i as T,k as mt,l as U,m as W,n as Y,o as xt,p as gt,s as vt,u as wt,v as I,w as Ct,x as Q,y as Mt,z as H,B as bt,D as Et,E as St,G as Pt,H as K,I as At,J as Z,K as E,L as P,N as _,Q as Dt,U as kt}from"./vendor.5f120d9a.js";const Ot=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=a(s);fetch(s.href,n)}};Ot();const J=D.createContext(null),$t=({children:t})=>{const e="my-city-climate-pqkfg",a=new at({id:e}),[r,s]=h.exports.useState(null),n=async()=>{const u=F.anonymous();try{return await a.logIn(u),s(a.currentUser),a.currentUser}catch{return s(null),null}},i=async(u,y)=>{const d=F.emailPassword(u,y);try{return await a.logIn(d),s(a.currentUser),a.currentUser}catch{return s(null),null}},p=()=>{var u;r!==null&&((u=a.currentUser)==null||u.logOut(),s(null))};return l(J.Provider,{value:{logIn:i,logOut:p,user:r,anonymousIn:n},children:t})},X=()=>{const t=h.exports.useContext(J);if(t==null)throw new Error("useRealmApp() called outside of a RealmApp?");return t},z=D.createContext(null),jt=({children:t})=>{const{user:e}=X(),[a,r]=h.exports.useState(null);return h.exports.useEffect(()=>{if(e!==null){const s=e.mongoClient("mongodb-atlas");r(s.db("mcc-climate"))}},[e]),l(z.Provider,{value:{db:a},children:t})},tt=()=>{const t=h.exports.useContext(z);if(t==null)throw new Error("useMongoDB() called outside of a MongoDB?");return t};const N={climate:new O({image:new j({radius:8,fill:new L({color:"#FC9292"}),stroke:new R({color:"#C86767",width:1})})}),perception:new O({image:new j({radius:3,fill:new L({color:"#c0ddff"}),stroke:new R({color:"#5f97dc",width:1})})}),synoptic:new O({image:new j({radius:5,fill:new L({color:"#d0ffc0"}),stroke:new R({color:"#74d350",width:1})})})},Lt=t=>t.type=="k"?N.climate:t.type=="s"?N.synoptic:t.type=="pp"?N.perception:new O,Rt=t=>t=="k"?10:t=="s"?9:(t=="pp",8),Ut=t=>{const e={k:[],s:[],pp:[]};return t.forEach(a=>{const r=new ot({geometry:new it(q(a.location.coordinates,"EPSG:4326","EPSG:3857")),name:a.name});switch(r.type=a.type,r.setProperties({code:a.code,name:a.name,type:a.type}),a.type){case"k":e.k.push(r);break;case"pp":e.pp.push(r);break;case"s":e.s.push(r);break;default:console.error(`Unknown station type: ${a.type}`)}}),e};function It(t){const e=h.exports.useRef(null);return h.exports.useEffect(()=>{const a=new ct({target:e.current,layers:[new lt({source:new ut})],view:new dt({projection:"EPSG:3857",center:q([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6,extent:pt([12.51284,48.3127,27.18045,56.36571],"EPSG:4326","EPSG:3857")}),controls:ft()});t.onMapCreate&&t.onMapCreate(a)},[]),l("div",{ref:e,className:"map-container"})}var Nt=D.memo(It,(t,e)=>!0);class Gt extends D.Component{constructor(e){super(e);k(this,"map");k(this,"stationsLayer",!1);k(this,"buildStationsLayer",()=>{if(!this.map)return;const e=this.map,a=Ut(this.props.stations);let r;for(r in a){const s=a[r],n=new ht({source:new yt({features:s}),style:Lt});n.setZIndex(Rt(r)),e.addLayer(n)}this.stationsLayer=!0,e.on("pointermove",s=>{const n=e.getEventPixel(s.originalEvent),i=e.hasFeatureAtPixel(n);e.getViewport().style.cursor=i?"pointer":""}),e.on("click",s=>{const{onClickFeatures:n}=this.props;if(!n)return;const i=[];e.getEventPixel(s.originalEvent),e.forEachFeatureAtPixel(s.pixel,p=>i.push(p)),n(i)})})}componentDidUpdate(e){e.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(e){this.map=e}render(){return l(Nt,{onMapCreate:e=>this.onMapCreate(e)})}}function Ft(t,{title:e,tickSize:a=6,width:r=320,height:s=44+a,marginTop:n=18,marginRight:i=0,marginBottom:p=16+a,marginLeft:u=0,ticks:y=r/64,tickFormat:d,tickValues:c}={}){function C(f,v=256){const m=document.createElement("canvas");m.width=v,m.height=1;const w=m.getContext("2d");for(let b=0;b<v;++b)w.fillStyle=f(b/(v-1)),w.fillRect(b,0,1,1);return m}const M=B("svg").attr("width",r).attr("height",s).attr("viewBox",[0,0,r,s]).style("overflow","visible").style("display","block");let A=f=>f.selectAll(".tick line").attr("y1",n+p-s),x;if(t.interpolate){const f=Math.min(t.domain().length,t.range().length);x=t.copy().rangeRound(V(T(u,r-i),f)),M.append("image").attr("x",u).attr("y",n).attr("width",r-u-i).attr("height",s-n-p).attr("preserveAspectRatio","none").attr("xlink:href",C(t.copy().domain(V(T(0,1),f))).toDataURL())}else if(t.interpolator){if(x=Object.assign(t.copy().interpolator(mt(u,r-i)),{range(){return[u,r-i]}}),M.append("image").attr("x",u).attr("y",n).attr("width",r-u-i).attr("height",s-n-p).attr("preserveAspectRatio","none").attr("xlink:href",C(t.interpolator()).toDataURL()),!x.ticks){if(c===void 0){const f=Math.round(y+1);c=U(f).map(v=>W(t.domain(),v/(f-1)))}typeof d!="function"&&(d=Y(d===void 0?",f":d))}}else if(t.invertExtent){const f=t.thresholds?t.thresholds():t.quantiles?t.quantiles():t.domain(),v=d===void 0?m=>m:typeof d=="string"?Y(d):d;x=xt().domain([-1,t.range().length-1]).rangeRound([u,r-i]),M.append("g").selectAll("rect").data(t.range()).join("rect").attr("x",(m,w)=>x(w-1)).attr("y",n).attr("width",(m,w)=>x(w)-x(w-1)).attr("height",s-n-p).attr("fill",m=>m),c=U(f.length),d=m=>v(f[m],m)}else x=gt().domain(t.domain()).rangeRound([u,r-i]),M.append("g").selectAll("rect").data(t.domain()).join("rect").attr("x",x).attr("y",n).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",s-n-p).attr("fill",t),A=()=>{};return M.append("g").attr("transform",`translate(0,${s-p})`).call(vt(x).ticks(y,typeof d=="string"?d:void 0).tickFormat(typeof d=="function"?d:void 0).tickSize(a).tickValues(c)).call(A).call(f=>f.select(".domain").remove()).call(f=>f.append("text").attr("x",u).attr("y",n+p-s-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(e)),M.node()}function qt(t,{x:e=([c])=>c,y:a=([,c])=>c,title:r,width:s=1e3,cellSize:n=12,weekday:i="monday",formatDay:p=c=>"SMTWTFS"[c],formatMonth:u="%b",yFormat:y,colors:d=wt}={}){const c=I(t,e),C=I(t,a),M=U(c.length),A=i==="sunday"?o=>o:o=>(o+6)%7,x=i==="sunday"?St:Pt,f=i==="weekday"?5:7,v=n*(f+.2);s=n*58;const m=W(C,.9975,Math.abs),w=Ct([-m,+m],d).unknown("none");if(u=Q(u),r===void 0){const o=Q("%B %-d, %Y"),g=w.tickFormat(100,y);r=S=>`${o(c[S])}
${g(C[S])}`}else if(r!==null){const o=I(t,r);r=g=>o[g]}const b=Mt(M,o=>c[o].getUTCFullYear()).reverse();function et(o){const g=Math.max(0,Math.min(f,A(o.getUTCDay()))),S=x.count(H(o),o);return`${g===0?`M${S*n},0`:g===f?`M${(S+1)*n},0`:`M${(S+1)*n},0V${g*n}H${S*n}`}V${f*n}`}const G=B("svg").attr("width",s).attr("height",v*b.length).attr("viewBox",[0,0,s,v*b.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size","15px"),$=G.selectAll("g").data(b).join("g").attr("id",(o,g)=>`mcc-year-${o[0]}`).attr("transform",(o,g)=>`translate(40.5,${v*g+n*1.5})`);$.append("text").attr("x",-5).attr("y",n*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([o])=>o);const nt=$.append("g").selectAll("rect").data(i==="weekday"?([,o])=>o.filter(g=>![0,6].includes(c[g].getUTCDay())):([,o])=>o).join("rect").attr("width",n-1).attr("height",n-1).attr("x",o=>x.count(H(c[o]),c[o])*n+.5).attr("y",o=>A(c[o].getUTCDay())*n+.5).attr("fill",o=>w(C[o]));return r&&nt.append("title").text(r),$.append("g").selectAll("g").data(([,o])=>bt(Et(c[o[0]]),c[o[o.length-1]])).join("g").filter((o,g)=>g).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",et),Object.assign(G.node(),{scales:{color:w}})}const Bt=l(K,{sx:{width:"100%",marginTop:"10%"},children:l(At,{})});function Vt(t){const{station:e,className:a}=t,[r,s]=h.exports.useState([]),n=h.exports.useRef(!0),{db:i}=tt(),p=h.exports.useRef(null);h.exports.useEffect(()=>()=>{n.current=!1},[]),h.exports.useEffect(()=>{if(r.length==0||!p||!p.current)return;const y=qt(r,{x:c=>c.ts,y:c=>c.tavg,cellSize:p.current.clientWidth/60,width:p.current.clientWidth-100}),d=Ft(y.scales.color,{title:"Daily average temperature",tickFormat:".0f"});p.current&&(p.current.appendChild(d),p.current.appendChild(y)),window.addEventListener("resize",function(c){console.log(c.detail)})},[r]),h.exports.useEffect(()=>{async function y(){if(!e)return;const d=e.getProperties();if(!d.hasOwnProperty("code"))return;const c=d.code;if(i){const C=await i.collection("observations").find({"source.code":parseInt(c,10)},{sort:{ts:-1}});n.current&&s(C)}}y()},[i]);let u;return r.length==0?u=Bt:u=l("div",{className:"grid",ref:p}),l("div",{className:a,children:u})}function Tt(t){const{station:e,onClose:a}=t,r=()=>a();let s=l(Dt,{});return e&&(s=l(Z,{open:!0,onClose:r,children:E("div",{className:"station-modal",children:[E("div",{className:"header",children:[l(P,{variant:"h6",children:e.getProperties().name}),l(_,{onClick:r,variant:"outlined",children:"Close"})]}),l(Vt,{className:"wrapper",station:e})]})})),s}var Wt="/mcc-frontend/assets/favicon.27019856.svg";function Yt(){const[t,e]=h.exports.useState(!1),a=()=>e(!0),r=()=>e(!1);return E(h.exports.Fragment,{children:[l("div",{className:"logo",title:"My city's climate",onClick:a,children:l("img",{src:Wt,alt:"My city's climate"})}),l(Z,{open:t,onClose:r,children:E(K,{className:"modal-logo-description",children:[l(P,{variant:"h6",component:"h2",children:"My city's climate"}),l(P,{sx:{mt:2},children:"Free online viewer for historical weather data"}),E(P,{sx:{mt:2},children:["The application uses ",l("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),E(P,{sx:{mt:2},children:["Source code - ",l("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),l(P,{align:"right",sx:{mt:2},children:l(_,{onClick:r,variant:"outlined",children:"Close"})})]})})]})}function Qt(){const{anonymousIn:t,user:e}=X(),{db:a}=tt(),[r,s]=h.exports.useState([]),[n,i]=h.exports.useState(null);h.exports.useEffect(()=>{async function y(){if(a){const d=await a.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});s(d)}}y()},[a]),h.exports.useEffect(()=>{e||t()});const p=y=>{y.length!=0&&i(y[0])},u=()=>{i(null)};return E(h.exports.Fragment,{children:[E("div",{className:"app",children:[l(Yt,{}),l(Gt,{stations:r,onClickFeatures:y=>p(y)})]}),l(Tt,{station:n,onClose:u})]})}kt.render(l(D.StrictMode,{children:l($t,{children:l(jt,{children:l(Qt,{})})})}),document.getElementById("root"));
