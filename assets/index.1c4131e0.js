var se=Object.defineProperty;var ae=(e,t,r)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var $=(e,t,r)=>(ae(e,typeof t!="symbol"?t+"":t,r),r);import{R as L,A as oe,r as m,j as i,C as q,S as O,a as N,F as U,b as B,c as ie,P as ce,t as V,M as le,T as ue,O as de,V as pe,d as fe,e as he,f as me,g as ye,h as W,q as H,i as Y,k as xe,l as G,m as K,n as Q,o as ge,p as ve,s as we,u as R,v as T,w as Ce,x as Me,y as be,z as Z,B as Se,D as _,E as ke,G as Ee,H as Pe,I as Ae,J as De,K as Ie,L as S,N as Le,Q as $e,U as Oe,W as Re,X,Y as je,Z as J,_ as D,$ as z,a0 as Ne,a1 as Ue}from"./vendor.40ceb83f.js";const Be=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}};Be();const ee=L.createContext(null),Ge=({children:e})=>{const t="my-city-climate-pqkfg",r=new oe({id:t}),[n,a]=m.exports.useState(null),s=async()=>{const p=q.anonymous();try{return await r.logIn(p),a(r.currentUser),r.currentUser}catch{return a(null),null}},c=async(p,x)=>{const f=q.emailPassword(p,x);try{return await r.logIn(f),a(r.currentUser),r.currentUser}catch{return a(null),null}},y=()=>{var p;n!==null&&((p=r.currentUser)==null||p.logOut(),a(null))};return i(ee.Provider,{value:{logIn:c,logOut:y,user:n,anonymousIn:s},children:e})},te=()=>{const e=m.exports.useContext(ee);if(e==null)throw new Error("useRealmApp() called outside of a RealmApp?");return e},ne=L.createContext(null),Te=({children:e})=>{const{user:t}=te(),[r,n]=m.exports.useState(null);return m.exports.useEffect(()=>{if(t!==null){const a=t.mongoClient("mongodb-atlas");n(a.db("mcc-climate"))}},[t]),i(ne.Provider,{value:{db:r},children:e})},re=()=>{const e=m.exports.useContext(ne);if(e==null)throw new Error("useMongoDB() called outside of a MongoDB?");return e};const F={climate:new O({image:new N({radius:8,fill:new U({color:"#FC9292"}),stroke:new B({color:"#C86767",width:1})})}),perception:new O({image:new N({radius:3,fill:new U({color:"#c0ddff"}),stroke:new B({color:"#5f97dc",width:1})})}),synoptic:new O({image:new N({radius:5,fill:new U({color:"#d0ffc0"}),stroke:new B({color:"#74d350",width:1})})})},Fe=e=>e.type=="k"?F.climate:e.type=="s"?F.synoptic:e.type=="pp"?F.perception:new O,qe=e=>e=="k"?10:e=="s"?9:(e=="pp",8),Ve=e=>{const t={k:[],s:[],pp:[]};return e.forEach(r=>{const n=new ie({geometry:new ce(V(r.location.coordinates,"EPSG:4326","EPSG:3857")),name:r.name});switch(n.type=r.type,n.setProperties({code:r.code,name:r.name,type:r.type}),r.type){case"k":t.k.push(n);break;case"pp":t.pp.push(n);break;case"s":t.s.push(n);break;default:console.error(`Unknown station type: ${r.type}`)}}),t};function We(e){const t=m.exports.useRef(null);return m.exports.useEffect(()=>{const r=new le({target:t.current,layers:[new ue({source:new de})],view:new pe({projection:"EPSG:3857",center:V([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6,extent:fe([11.51284,46.3127,28.18045,58.36571],"EPSG:4326","EPSG:3857")}),controls:he()});e.onMapCreate&&e.onMapCreate(r)},[]),i("div",{ref:t,className:"map-container"})}var He=L.memo(We,(e,t)=>!0);class Ye extends L.Component{constructor(t){super(t);$(this,"map");$(this,"stationsLayer",!1);$(this,"buildStationsLayer",()=>{if(!this.map)return;const t=this.map,r=Ve(this.props.stations);let n;for(n in r){const a=r[n],s=new me({source:new ye({features:a}),style:Fe});s.setZIndex(qe(n)),t.addLayer(s),n=="k"&&t.getView().fit(s.getSource().getExtent(),{padding:[50,50,50,50]})}this.stationsLayer=!0,t.on("pointermove",a=>{const s=t.getEventPixel(a.originalEvent),c=t.hasFeatureAtPixel(s);t.getViewport().style.cursor=c?"pointer":""}),t.on("click",a=>{const{onClickFeatures:s}=this.props;if(!s)return;const c=[];t.getEventPixel(a.originalEvent),t.forEachFeatureAtPixel(a.pixel,y=>c.push(y)),s(c)})})}componentDidUpdate(t){t.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(t){this.map=t}render(){return i(He,{onMapCreate:t=>this.onMapCreate(t)})}}function Ke(e,{title:t,tickSize:r=6,width:n=320,height:a=44+r,marginTop:s=18,marginRight:c=0,marginBottom:y=16+r,marginLeft:p=0,ticks:x=n/64,tickFormat:f,tickValues:l}={}){function v(d,u=256){const h=document.createElement("canvas");h.width=u,h.height=1;const w=h.getContext("2d");for(let C=0;C<u;++C)w.fillStyle=d(C/(u-1)),w.fillRect(C,0,1,1);return h}const b=W("svg").attr("width",n).attr("height",a).attr("viewBox",[0,0,n,a]).style("overflow","visible").style("display","block");let k=d=>d.selectAll(".tick line").attr("y1",s+y-a),g;if(e.interpolate){const d=Math.min(e.domain().length,e.range().length);g=e.copy().rangeRound(H(Y(p,n-c),d)),b.append("image").attr("x",p).attr("y",s).attr("width",n-p-c).attr("height",a-s-y).attr("preserveAspectRatio","none").attr("xlink:href",v(e.copy().domain(H(Y(0,1),d))).toDataURL())}else if(e.interpolator){if(g=Object.assign(e.copy().interpolator(xe(p,n-c)),{range(){return[p,n-c]}}),b.append("image").attr("x",p).attr("y",s).attr("width",n-p-c).attr("height",a-s-y).attr("preserveAspectRatio","none").attr("xlink:href",v(e.interpolator()).toDataURL()),!g.ticks){if(l===void 0){const d=Math.round(x+1);l=G(d).map(u=>K(e.domain(),u/(d-1)))}typeof f!="function"&&(f=Q(f===void 0?",f":f))}}else if(e.invertExtent){const d=e.thresholds?e.thresholds():e.quantiles?e.quantiles():e.domain(),u=f===void 0?h=>h:typeof f=="string"?Q(f):f;g=ge().domain([-1,e.range().length-1]).rangeRound([p,n-c]),b.append("g").selectAll("rect").data(e.range()).join("rect").attr("x",(h,w)=>g(w-1)).attr("y",s).attr("width",(h,w)=>g(w)-g(w-1)).attr("height",a-s-y).attr("fill",h=>h),l=G(d.length),f=h=>u(d[h],h)}else g=ve().domain(e.domain()).rangeRound([p,n-c]),b.append("g").selectAll("rect").data(e.domain()).join("rect").attr("x",g).attr("y",s).attr("width",Math.max(0,g.bandwidth()-1)).attr("height",a-s-y).attr("fill",e),k=()=>{};return b.append("g").attr("transform",`translate(0,${a-y})`).call(we(g).ticks(x,typeof f=="string"?f:void 0).tickFormat(typeof f=="function"?f:void 0).tickSize(r).tickValues(l)).call(k).call(d=>d.select(".domain").remove()).call(d=>d.append("text").attr("x",p).attr("y",s+y-a-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(t)),b.node()}function Qe(e,{x:t=([l])=>l,y:r=([,l])=>l,title:n,width:a=1e3,cellSize:s=12,weekday:c="monday",formatDay:y=l=>"SMTWTFS"[l],formatMonth:p="%b",yFormat:x,colors:f=R}={}){const l=T(e,t),v=T(e,r),b=G(l.length),k=c==="sunday"?o=>o:o=>(o+6)%7,g=c==="sunday"?Pe:Ae,d=c==="weekday"?5:7,u=s*(d+.2);a=s*58,K(v,.9975,Math.abs);const h=Ce([Me(v),be(v)],f).unknown("none");if(p=Z(p),n===void 0){const o=Z("%B %-d, %Y"),M=h.tickFormat(100,x);n=E=>`${o(l[E])}
${M(v[E])}`}else if(n!==null){const o=T(e,n);n=M=>o[M]}const w=Se(b,o=>l[o].getUTCFullYear()).reverse();function C(o){const M=Math.max(0,Math.min(d,k(o.getUTCDay()))),E=g.count(_(o),o);return`${M===0?`M${E*s},0`:M===d?`M${(E+1)*s},0`:`M${(E+1)*s},0V${M*s}H${E*s}`}V${d*s}`}const A=W("svg").attr("width",a).attr("height",u*w.length).attr("viewBox",[0,0,a,u*w.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size","14px"),I=A.selectAll("g").data(w).join("g").attr("id",(o,M)=>`mcc-year-${o[0]}`).attr("transform",(o,M)=>`translate(40.5,${u*M+s*1.5})`);I.append("text").attr("x",-5).attr("y",s*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([o])=>o);const j=I.append("g").selectAll("rect").data(c==="weekday"?([,o])=>o.filter(M=>![0,6].includes(l[M].getUTCDay())):([,o])=>o).join("rect").attr("width",s-1).attr("height",s-1).attr("x",o=>g.count(_(l[o]),l[o])*s+.5).attr("y",o=>k(l[o].getUTCDay())*s+.5).attr("fill",o=>h(v[o]));return n&&j.append("title").text(n),I.append("g").selectAll("g").data(([,o])=>ke(Ee(l[o[0]]),l[o[o.length-1]])).join("g").filter((o,M)=>M).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",C),Object.assign(A.node(),{scales:{color:h}})}const Ze=e=>{if(e.length==0)return[];const t=e[0],r=[];let n;for(n in t)switch(n){case"tavg":r.push({key:n,name:"Average Air Temperature, \xB0C",colorsScheme:R});break;case"tmax":r.push({key:n,name:"Maximum Air Temperature, \xB0C",colorsScheme:R});break;case"tmin":r.push({key:n,name:"Minimum Air Temperature, \xB0C",colorsScheme:R});break;case"precip":r.push({key:n,name:"Precipitation, mm",colorsScheme:Ie});break;case"snowd":r.push({key:n,name:"Snow Depth, mm",colorsScheme:De});break}return r},_e=i(X,{sx:{width:"100%",marginTop:"10%"},children:i(je,{})});let P=null;function Xe(e){const{station:t,className:r}=e,[n,a]=m.exports.useState(""),[s,c]=m.exports.useState([]),[y,p]=m.exports.useState([]),x=m.exports.useRef(!0),{db:f}=re(),l=m.exports.useRef(null),v=m.exports.useRef(null),b=u=>{a(u.target.value)};m.exports.useEffect(()=>()=>{x.current=!1,P&&window.removeEventListener("resize",P),P=null},[]),m.exports.useEffect(()=>{async function u(){if(!t)return;const h=t.getProperties();if(!h.hasOwnProperty("code"))return;const w=h.code;if(f){const C=await f.collection("observations").find({"source.code":parseInt(w,10)},{sort:{ts:-1}}),A=Ze(C).sort((I,j)=>I.name>j.name?1:-1);x.current&&(c(A),a(A.length>0?A[0].key:""),p(C))}}u()},[f]),m.exports.useEffect(()=>{y.length>0&&n!=""&&(g(),k())},[y,n]);const k=()=>{let u;P&&window.removeEventListener("resize",P),P=()=>{clearTimeout(u),u=setTimeout(g,500)},window.addEventListener("resize",P)},g=()=>{if(y.length==0||!l||!l.current||!v||!v.current)return;const u=s.find(C=>C.key==n);if(!u)return;const h=Qe(y,{x:C=>C.ts,y:C=>C[n],cellSize:v.current.clientWidth/60,width:v.current.clientWidth-100,colors:u.colorsScheme});v.current.innerHTML="",v.current.appendChild(h);const w=Ke(h.scales.color,{title:u.name,tickFormat:".0f"});l.current.innerHTML="",l.current.appendChild(w)};let d;return y.length==0?d=_e:d=S("div",{className:"grid",children:[i("div",{className:"controls",children:S(Le,{sx:{minWidth:200},size:"small",children:[i($e,{id:"demo-simple-select-label",children:"Indicator"}),i(Oe,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:n,label:"Indicator",onChange:b,children:s.map(u=>i(Re,{value:u.key,children:u.name},u.key))})]})}),i("div",{className:"legend",ref:l}),i("div",{className:"calendar",ref:v})]}),i("div",{className:r,children:d})}function Je(e){const{station:t,onClose:r}=e,n=()=>r();let a=i(Ne,{});return t&&(a=i(J,{open:!0,onClose:n,children:S("div",{className:"station-modal",children:[S("div",{className:"header",children:[i(D,{variant:"h6",children:t.getProperties().name}),i(z,{onClick:n,variant:"outlined",children:"Close"})]}),i(Xe,{className:"wrapper",station:t})]})})),a}var ze="/mcc-frontend/assets/favicon.27019856.svg";function et(){const[e,t]=m.exports.useState(!1),r=()=>t(!0),n=()=>t(!1);return S(m.exports.Fragment,{children:[i("div",{className:"logo",title:"My city's climate",onClick:r,children:i("img",{src:ze,alt:"My city's climate"})}),i(J,{open:e,onClose:n,children:S(X,{className:"modal-logo-description",children:[i(D,{variant:"h6",component:"h2",children:"My city's climate"}),i(D,{sx:{mt:2},children:"Free online viewer for historical weather data"}),S(D,{sx:{mt:2},children:["The application uses ",i("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),S(D,{sx:{mt:2},children:["Source code - ",i("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),i(D,{align:"right",sx:{mt:2},children:i(z,{onClick:n,variant:"outlined",children:"Close"})})]})})]})}function tt(){const{anonymousIn:e,user:t}=te(),{db:r}=re(),[n,a]=m.exports.useState([]),[s,c]=m.exports.useState(null);m.exports.useEffect(()=>{async function x(){if(r){const f=await r.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});a(f)}}x()},[r]),m.exports.useEffect(()=>{t||e()});const y=x=>{x.length!=0&&c(x[0])},p=()=>{c(null)};return S(m.exports.Fragment,{children:[S("div",{className:"app",children:[i(et,{}),i(Ye,{stations:n,onClickFeatures:x=>y(x)})]}),i(Je,{station:s,onClose:p})]})}Ue.render(i(L.StrictMode,{children:i(Ge,{children:i(Te,{children:i(tt,{})})})}),document.getElementById("root"));
