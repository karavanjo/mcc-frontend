var P=Object.defineProperty;var O=(n,e,t)=>e in n?P(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>(O(n,typeof e!="symbol"?e+"":e,t),t);import{R as u,A,r as i,j as s,C as v,S as m,a as h,F as y,b as g,c as k,P as B,t as S,M as D,T as I,O as R,V as F,d as j,e as U,f as p,g as G,B as N,h as d,i as T,k as V}from"./vendor.b207d8cd.js";const $=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}};$();const M=u.createContext(null),z=({children:n})=>{const e="my-city-climate-pqkfg",t=new A({id:e}),[r,o]=i.exports.useState(null),a=async()=>{const l=v.anonymous();try{return await t.logIn(l),o(t.currentUser),t.currentUser}catch{return o(null),null}},c=async(l,x)=>{const L=v.emailPassword(l,x);try{return await t.logIn(L),o(t.currentUser),t.currentUser}catch{return o(null),null}},E=()=>{var l;r!==null&&((l=t.currentUser)==null||l.logOut(),o(null))};return s(M.Provider,{value:{logIn:c,logOut:E,user:r,anonymousIn:a},children:n})},C=()=>{const n=i.exports.useContext(M);if(n==null)throw new Error("useRealmApp() called outside of a RealmApp?");return n},b=u.createContext(null),q=({children:n})=>{const{user:e}=C(),[t,r]=i.exports.useState(null);return i.exports.useEffect(()=>{if(e!==null){const o=e.mongoClient("mongodb-atlas");r(o.db("mcc-climate"))}},[e]),s(b.Provider,{value:{db:t},children:n})},_=()=>{const n=i.exports.useContext(b);if(n==null)throw new Error("useMongoDB() called outside of a MongoDB?");return n};const w={climate:new m({image:new h({radius:5,fill:new y({color:"#FC9292"}),stroke:new g({color:"#C86767",width:1})})}),perception:new m({image:new h({radius:5,fill:new y({color:"#c0ddff"}),stroke:new g({color:"#5f97dc",width:1})})}),synoptic:new m({image:new h({radius:5,fill:new y({color:"#d0ffc0"}),stroke:new g({color:"#74d350",width:1})})})},K=n=>n.type=="k"?w.climate:n.type=="s"?w.synoptic:n.type=="pp"?w.perception:new m,Q=n=>{const e=[];return n.forEach(t=>{const r=new k({geometry:new B(S(t.location.coordinates,"EPSG:4326","EPSG:3857")),name:t.name});r.type=t.type,r.setProperties({code:t.code,name:t.name,type:t.type}),e.push(r)}),e};function W(n){const e=i.exports.useRef(null);return i.exports.useEffect(()=>{const t=new D({target:e.current,layers:[new I({source:new R})],view:new F({projection:"EPSG:3857",center:S([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6}),controls:[]});n.onMapCreate&&n.onMapCreate(t)},[]),s("div",{ref:e,className:"map-container"})}var Y=u.memo(W,(n,e)=>!0);class H extends u.Component{constructor(e){super(e);f(this,"map");f(this,"stationsLayer");f(this,"buildStationsLayer",()=>{if(!this.map)return;const e=this.map,t=Q(this.props.stations),r=new j({source:new U({features:t}),style:K});e.addLayer(r),e.getView().fit(r.getSource().getExtent(),{padding:[50,50,50,50]}),e.on("pointermove",o=>{const a=e.getEventPixel(o.originalEvent),c=e.hasFeatureAtPixel(a);e.getViewport().style.cursor=c?"pointer":""}),this.stationsLayer=r})}componentDidUpdate(e){e.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(e){this.map=e}render(){return s(Y,{onMapCreate:e=>this.onMapCreate(e)})}}var J="/mcc-frontend/assets/favicon.27019856.svg";const X={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,"z-index":99999};function Z(){const[n,e]=i.exports.useState(!1),t=()=>e(!0),r=()=>e(!1);return p(i.exports.Fragment,{children:[s("div",{className:"logo",title:"My city's climate",onClick:t,children:s("img",{src:J,alt:"My city's climate"})}),s(G,{open:n,onClose:r,children:p(N,{sx:X,children:[s(d,{variant:"h6",component:"h2",children:"My city's climate"}),s(d,{sx:{mt:2},children:"Free online viewer for historical weather data"}),p(d,{sx:{mt:2},children:["The application uses ",s("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),p(d,{sx:{mt:2},children:["Source code - ",s("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),s(d,{align:"right",sx:{mt:2},children:s(T,{onClick:r,variant:"outlined",children:"Close"})})]})})]})}function ee(){const{anonymousIn:n,user:e}=C(),{db:t}=_(),[r,o]=i.exports.useState([]);return i.exports.useEffect(()=>{async function a(){if(t){const c=await t.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});o(c)}}a()},[t]),i.exports.useEffect(()=>{e||n()}),p("div",{className:"app",children:[s(Z,{}),s(H,{stations:r})]})}V.render(s(u.StrictMode,{children:s(z,{children:s(q,{children:s(ee,{})})})}),document.getElementById("root"));
