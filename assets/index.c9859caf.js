import{j as h,R as m,A,r as c,C as E,V as b,a as M,M as O,T as R,O as L,b as j,t as y,S as p,c as g,F as w,d as x,e as k,P as D,f as I}from"./vendor.88e7475b.js";const F=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}};F();const i=h.exports.jsx,G=h.exports.jsxs,v=m.createContext(null),B=({children:t})=>{const s="my-city-climate-pqkfg",o=new A({id:s}),[n,e]=c.exports.useState(null),r=async()=>{const l=E.anonymous();try{return await o.logIn(l),e(o.currentUser),o.currentUser}catch{return e(null),null}},a=async(l,u)=>{const d=E.emailPassword(l,u);try{return await o.logIn(d),e(o.currentUser),o.currentUser}catch{return e(null),null}},f=()=>{var l;n!==null&&((l=o.currentUser)==null||l.logOut(),e(null))};return i(v.Provider,{value:{logIn:a,logOut:f,user:n,anonymousIn:r},children:t})},P=()=>{const t=c.exports.useContext(v);if(t==null)throw new Error("useRealmApp() called outside of a RealmApp?");return t},C=m.createContext(null),N=({children:t})=>{const{user:s}=P(),[o,n]=c.exports.useState(null);return c.exports.useEffect(()=>{if(s!==null){const e=s.mongoClient("mongodb-atlas");n(e.db("mcc-climate"))}},[s]),i(C.Provider,{value:{db:o},children:t})},U=()=>{const t=c.exports.useContext(C);if(t==null)throw new Error("useMongoDB() called outside of a MongoDB?");return t};function V(t){const[s,o]=c.exports.useState(null),[n,e]=c.exports.useState(),r=c.exports.useRef(null),a=c.exports.useRef(null);a.current=s,c.exports.useEffect(()=>{const l=new b({source:new M});t.getStyle&&l.setStyle(t.getStyle);const u=new O({target:r.current,layers:[new R({source:new L}),l],view:new j({projection:"EPSG:3857",center:y([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:7}),controls:[]});u.on("click",f),o(u),e(l)},[]),c.exports.useEffect(()=>{t.features&&t.features.length&&(n==null||n.setSource(new M({features:t.features})))},[t.features]);const f=l=>{var d;const u=(d=a==null?void 0:a.current)==null?void 0:d.getCoordinateFromPixel(l.pixel);!u||y(u,"EPSG:3857","EPSG:4326")};return i("div",{ref:r,className:"map-container"})}const S={climate:new p({image:new g({radius:5,fill:new w({color:"#FC9292"}),stroke:new x({color:"#C86767",width:1})})}),perception:new p({image:new g({radius:5,fill:new w({color:"#c0ddff"}),stroke:new x({color:"#5f97dc",width:1})})}),synoptic:new p({image:new g({radius:5,fill:new w({color:"#d0ffc0"}),stroke:new x({color:"#74d350",width:1})})})},T=t=>t.type=="k"?S.climate:t.type=="s"?S.synoptic:t.type=="pp"?S.perception:new p;function $(t){const{stations:s}=t,o=[];return s&&s.length>0&&s.forEach(n=>{const e=new k({geometry:new D(y(n.location.coordinates,"EPSG:4326","EPSG:3857")),name:n.name});e.type=n.type,e.setProperties({code:n.code,name:n.name,type:n.type}),o.push(e)}),i(V,{features:o,getStyle:T})}var q="/assets/favicon.27019856.svg";function _(){const{anonymousIn:t,user:s}=P(),{db:o}=U(),[n,e]=c.exports.useState([]);c.exports.useEffect(()=>{async function a(){if(o){const f=await o.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});e(f)}}a()},[o]),c.exports.useEffect(()=>{s||t()});let r;return n?r=i($,{stations:n}):r=i("span",{children:"loading"}),G("div",{className:"app",children:[i("div",{className:"logo",title:"My city's climate",children:i("img",{src:q,alt:"My city's climate"})}),r]})}I.render(i(m.StrictMode,{children:i(B,{children:i(N,{children:i(_,{})})})}),document.getElementById("root"));
