var A=Object.defineProperty;var O=(n,e,t)=>e in n?A(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>(O(n,typeof e!="symbol"?e+"":e,t),t);import{R as f,A as B,r as i,j as r,C as S,S as g,a as w,F as x,b as C,c as D,P as I,t as M,M as R,T as j,O as N,V as U,d as G,e as T,f as E,g as p,B as P,h as d,i as L,k as V,l as $}from"./vendor.0c3525d9.js";const z=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}};z();const b=f.createContext(null),q=({children:n})=>{const e="my-city-climate-pqkfg",t=new B({id:e}),[s,o]=i.exports.useState(null),a=async()=>{const u=S.anonymous();try{return await t.logIn(u),o(t.currentUser),t.currentUser}catch{return o(null),null}},c=async(u,l)=>{const y=S.emailPassword(u,l);try{return await t.logIn(y),o(t.currentUser),t.currentUser}catch{return o(null),null}},m=()=>{var u;s!==null&&((u=t.currentUser)==null||u.logOut(),o(null))};return r(b.Provider,{value:{logIn:c,logOut:m,user:s,anonymousIn:a},children:n})},k=()=>{const n=i.exports.useContext(b);if(n==null)throw new Error("useRealmApp() called outside of a RealmApp?");return n},F=f.createContext(null),_=({children:n})=>{const{user:e}=k(),[t,s]=i.exports.useState(null);return i.exports.useEffect(()=>{if(e!==null){const o=e.mongoClient("mongodb-atlas");s(o.db("mcc-climate"))}},[e]),r(F.Provider,{value:{db:t},children:n})},K=()=>{const n=i.exports.useContext(F);if(n==null)throw new Error("useMongoDB() called outside of a MongoDB?");return n};const v={climate:new g({image:new w({radius:8,fill:new x({color:"#FC9292"}),stroke:new C({color:"#C86767",width:1})})}),perception:new g({image:new w({radius:3,fill:new x({color:"#c0ddff"}),stroke:new C({color:"#5f97dc",width:1})})}),synoptic:new g({image:new w({radius:5,fill:new x({color:"#d0ffc0"}),stroke:new C({color:"#74d350",width:1})})})},Q=n=>n.type=="k"?v.climate:n.type=="s"?v.synoptic:n.type=="pp"?v.perception:new g,W=n=>{const e=[];return n.forEach(t=>{const s=new D({geometry:new I(M(t.location.coordinates,"EPSG:4326","EPSG:3857")),name:t.name});s.type=t.type,s.setProperties({code:t.code,name:t.name,type:t.type}),e.push(s)}),e};function Y(n){const e=i.exports.useRef(null);return i.exports.useEffect(()=>{const t=new R({target:e.current,layers:[new j({source:new N})],view:new U({projection:"EPSG:3857",center:M([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6}),controls:[]});n.onMapCreate&&n.onMapCreate(t)},[]),r("div",{ref:e,className:"map-container"})}var H=f.memo(Y,(n,e)=>!0);class J extends f.Component{constructor(e){super(e);h(this,"map");h(this,"stationsLayer");h(this,"buildStationsLayer",()=>{if(!this.map)return;const e=this.map,t=W(this.props.stations),s=new G({source:new T({features:t}),style:Q});e.addLayer(s),e.getView().fit(s.getSource().getExtent(),{padding:[50,50,50,50]}),e.on("pointermove",o=>{const a=e.getEventPixel(o.originalEvent),c=e.hasFeatureAtPixel(a);e.getViewport().style.cursor=c?"pointer":""}),e.on("click",o=>{const{onClickFeatures:a}=this.props;if(!a)return;const c=[];e.getEventPixel(o.originalEvent),e.forEachFeatureAtPixel(o.pixel,m=>c.push(m)),a(c)}),this.stationsLayer=s})}componentDidUpdate(e){e.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(e){this.map=e}render(){return r(H,{onMapCreate:e=>this.onMapCreate(e)})}}function X(n){const{station:e,onClose:t}=n,s=()=>t();let o=r(V,{});return e&&(o=r(E,{open:!0,onClose:s,children:p(P,{className:"station-modal",children:[r(d,{variant:"h3",component:"h3",children:e.getProperties().name}),p(d,{sx:{mt:2},children:["Code: ",e.getProperties().code]}),r(d,{align:"right",sx:{mt:2},children:r(L,{onClick:s,variant:"outlined",children:"Close"})})]})})),o}var Z="/mcc-frontend/assets/favicon.27019856.svg";function ee(){const[n,e]=i.exports.useState(!1),t=()=>e(!0),s=()=>e(!1);return p(i.exports.Fragment,{children:[r("div",{className:"logo",title:"My city's climate",onClick:t,children:r("img",{src:Z,alt:"My city's climate"})}),r(E,{open:n,onClose:s,children:p(P,{className:"modal-logo-description",children:[r(d,{variant:"h6",component:"h2",children:"My city's climate"}),r(d,{sx:{mt:2},children:"Free online viewer for historical weather data"}),p(d,{sx:{mt:2},children:["The application uses ",r("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),p(d,{sx:{mt:2},children:["Source code - ",r("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),r(d,{align:"right",sx:{mt:2},children:r(L,{onClick:s,variant:"outlined",children:"Close"})})]})})]})}function te(){const{anonymousIn:n,user:e}=k(),{db:t}=K(),[s,o]=i.exports.useState([]),[a,c]=i.exports.useState(null);i.exports.useEffect(()=>{async function l(){if(t){const y=await t.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});o(y)}}l()},[t]),i.exports.useEffect(()=>{e||n()});const m=l=>{l.length!=0&&c(l[0])},u=()=>{c(null)};return p(i.exports.Fragment,{children:[p("div",{className:"app",children:[r(ee,{}),r(J,{stations:s,onClickFeatures:l=>m(l)})]}),r(X,{station:a,onClose:u})]})}$.render(r(f.StrictMode,{children:r(q,{children:r(_,{children:r(te,{})})})}),document.getElementById("root"));
