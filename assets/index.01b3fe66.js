var rt=Object.defineProperty;var st=(t,e,a)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var D=(t,e,a)=>(st(t,typeof e!="symbol"?e+"":e,a),a);import{R as k,A as at,r as f,j as l,C as F,S as O,a as L,F as R,b as j,c as ot,P as it,t as T,M as ct,T as lt,O as ut,V as dt,d as pt,e as ft,f as ht,g as yt,h as q,q as B,i as V,k as mt,l as N,m as H,n as W,o as gt,p as xt,s as vt,u as wt,v as U,w as Ct,x as Y,y as Mt,z as Q,B as bt,D as Et,E as St,G as Pt,H as E,I as K,J as At,K as Z,L as A,N as _,Q as kt,U as Dt}from"./vendor.11ec4672.js";const Ot=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=a(r);fetch(r.href,n)}};Ot();const J=k.createContext(null),$t=({children:t})=>{const e="my-city-climate-pqkfg",a=new at({id:e}),[s,r]=f.exports.useState(null),n=async()=>{const c=F.anonymous();try{return await a.logIn(c),r(a.currentUser),a.currentUser}catch{return r(null),null}},i=async(c,m)=>{const p=F.emailPassword(c,m);try{return await a.logIn(p),r(a.currentUser),a.currentUser}catch{return r(null),null}},h=()=>{var c;s!==null&&((c=a.currentUser)==null||c.logOut(),r(null))};return l(J.Provider,{value:{logIn:i,logOut:h,user:s,anonymousIn:n},children:t})},X=()=>{const t=f.exports.useContext(J);if(t==null)throw new Error("useRealmApp() called outside of a RealmApp?");return t},z=k.createContext(null),Lt=({children:t})=>{const{user:e}=X(),[a,s]=f.exports.useState(null);return f.exports.useEffect(()=>{if(e!==null){const r=e.mongoClient("mongodb-atlas");s(r.db("mcc-climate"))}},[e]),l(z.Provider,{value:{db:a},children:t})},tt=()=>{const t=f.exports.useContext(z);if(t==null)throw new Error("useMongoDB() called outside of a MongoDB?");return t};const I={climate:new O({image:new L({radius:8,fill:new R({color:"#FC9292"}),stroke:new j({color:"#C86767",width:1})})}),perception:new O({image:new L({radius:3,fill:new R({color:"#c0ddff"}),stroke:new j({color:"#5f97dc",width:1})})}),synoptic:new O({image:new L({radius:5,fill:new R({color:"#d0ffc0"}),stroke:new j({color:"#74d350",width:1})})})},Rt=t=>t.type=="k"?I.climate:t.type=="s"?I.synoptic:t.type=="pp"?I.perception:new O,jt=t=>t=="k"?10:t=="s"?9:(t=="pp",8),Nt=t=>{const e={k:[],s:[],pp:[]};return t.forEach(a=>{const s=new ot({geometry:new it(T(a.location.coordinates,"EPSG:4326","EPSG:3857")),name:a.name});switch(s.type=a.type,s.setProperties({code:a.code,name:a.name,type:a.type}),a.type){case"k":e.k.push(s);break;case"pp":e.pp.push(s);break;case"s":e.s.push(s);break;default:console.error(`Unknown station type: ${a.type}`)}}),e};function Ut(t){const e=f.exports.useRef(null);return f.exports.useEffect(()=>{const a=new ct({target:e.current,layers:[new lt({source:new ut})],view:new dt({projection:"EPSG:3857",center:T([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6,extent:pt([11.51284,46.3127,28.18045,58.36571],"EPSG:4326","EPSG:3857")}),controls:ft()});t.onMapCreate&&t.onMapCreate(a)},[]),l("div",{ref:e,className:"map-container"})}var It=k.memo(Ut,(t,e)=>!0);class Gt extends k.Component{constructor(e){super(e);D(this,"map");D(this,"stationsLayer",!1);D(this,"buildStationsLayer",()=>{if(!this.map)return;const e=this.map,a=Nt(this.props.stations);let s;for(s in a){const r=a[s],n=new ht({source:new yt({features:r}),style:Rt});n.setZIndex(jt(s)),e.addLayer(n),s=="k"&&e.getView().fit(n.getSource().getExtent(),{padding:[50,50,50,50]})}this.stationsLayer=!0,e.on("pointermove",r=>{const n=e.getEventPixel(r.originalEvent),i=e.hasFeatureAtPixel(n);e.getViewport().style.cursor=i?"pointer":""}),e.on("click",r=>{const{onClickFeatures:n}=this.props;if(!n)return;const i=[];e.getEventPixel(r.originalEvent),e.forEachFeatureAtPixel(r.pixel,h=>i.push(h)),n(i)})})}componentDidUpdate(e){e.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(e){this.map=e}render(){return l(It,{onMapCreate:e=>this.onMapCreate(e)})}}function Ft(t,{title:e,tickSize:a=6,width:s=320,height:r=44+a,marginTop:n=18,marginRight:i=0,marginBottom:h=16+a,marginLeft:c=0,ticks:m=s/64,tickFormat:p,tickValues:u}={}){function M(d,w=256){const g=document.createElement("canvas");g.width=w,g.height=1;const C=g.getContext("2d");for(let S=0;S<w;++S)C.fillStyle=d(S/(w-1)),C.fillRect(S,0,1,1);return g}const v=q("svg").attr("width",s).attr("height",r).attr("viewBox",[0,0,s,r]).style("overflow","visible").style("display","block");let b=d=>d.selectAll(".tick line").attr("y1",n+h-r),y;if(t.interpolate){const d=Math.min(t.domain().length,t.range().length);y=t.copy().rangeRound(B(V(c,s-i),d)),v.append("image").attr("x",c).attr("y",n).attr("width",s-c-i).attr("height",r-n-h).attr("preserveAspectRatio","none").attr("xlink:href",M(t.copy().domain(B(V(0,1),d))).toDataURL())}else if(t.interpolator){if(y=Object.assign(t.copy().interpolator(mt(c,s-i)),{range(){return[c,s-i]}}),v.append("image").attr("x",c).attr("y",n).attr("width",s-c-i).attr("height",r-n-h).attr("preserveAspectRatio","none").attr("xlink:href",M(t.interpolator()).toDataURL()),!y.ticks){if(u===void 0){const d=Math.round(m+1);u=N(d).map(w=>H(t.domain(),w/(d-1)))}typeof p!="function"&&(p=W(p===void 0?",f":p))}}else if(t.invertExtent){const d=t.thresholds?t.thresholds():t.quantiles?t.quantiles():t.domain(),w=p===void 0?g=>g:typeof p=="string"?W(p):p;y=gt().domain([-1,t.range().length-1]).rangeRound([c,s-i]),v.append("g").selectAll("rect").data(t.range()).join("rect").attr("x",(g,C)=>y(C-1)).attr("y",n).attr("width",(g,C)=>y(C)-y(C-1)).attr("height",r-n-h).attr("fill",g=>g),u=N(d.length),p=g=>w(d[g],g)}else y=xt().domain(t.domain()).rangeRound([c,s-i]),v.append("g").selectAll("rect").data(t.domain()).join("rect").attr("x",y).attr("y",n).attr("width",Math.max(0,y.bandwidth()-1)).attr("height",r-n-h).attr("fill",t),b=()=>{};return v.append("g").attr("transform",`translate(0,${r-h})`).call(vt(y).ticks(m,typeof p=="string"?p:void 0).tickFormat(typeof p=="function"?p:void 0).tickSize(a).tickValues(u)).call(b).call(d=>d.select(".domain").remove()).call(d=>d.append("text").attr("x",c).attr("y",n+h-r-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(e)),v.node()}function Tt(t,{x:e=([u])=>u,y:a=([,u])=>u,title:s,width:r=1e3,cellSize:n=12,weekday:i="monday",formatDay:h=u=>"SMTWTFS"[u],formatMonth:c="%b",yFormat:m,colors:p=wt}={}){const u=U(t,e),M=U(t,a),v=N(u.length),b=i==="sunday"?o=>o:o=>(o+6)%7,y=i==="sunday"?St:Pt,d=i==="weekday"?5:7,w=n*(d+.2);r=n*58;const g=H(M,.9975,Math.abs),C=Ct([-g,+g],p).unknown("none");if(c=Y(c),s===void 0){const o=Y("%B %-d, %Y"),x=C.tickFormat(100,m);s=P=>`${o(u[P])}
${x(M[P])}`}else if(s!==null){const o=U(t,s);s=x=>o[x]}const S=Mt(v,o=>u[o].getUTCFullYear()).reverse();function et(o){const x=Math.max(0,Math.min(d,b(o.getUTCDay()))),P=y.count(Q(o),o);return`${x===0?`M${P*n},0`:x===d?`M${(P+1)*n},0`:`M${(P+1)*n},0V${x*n}H${P*n}`}V${d*n}`}const G=q("svg").attr("width",r).attr("height",w*S.length).attr("viewBox",[0,0,r,w*S.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size","14px"),$=G.selectAll("g").data(S).join("g").attr("id",(o,x)=>`mcc-year-${o[0]}`).attr("transform",(o,x)=>`translate(40.5,${w*x+n*1.5})`);$.append("text").attr("x",-5).attr("y",n*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([o])=>o);const nt=$.append("g").selectAll("rect").data(i==="weekday"?([,o])=>o.filter(x=>![0,6].includes(u[x].getUTCDay())):([,o])=>o).join("rect").attr("width",n-1).attr("height",n-1).attr("x",o=>y.count(Q(u[o]),u[o])*n+.5).attr("y",o=>b(u[o].getUTCDay())*n+.5).attr("fill",o=>C(M[o]));return s&&nt.append("title").text(s),$.append("g").selectAll("g").data(([,o])=>bt(Et(u[o[0]]),u[o[o.length-1]])).join("g").filter((o,x)=>x).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",et),Object.assign(G.node(),{scales:{color:C}})}const qt=l(K,{sx:{width:"100%",marginTop:"10%"},children:l(At,{})});function Bt(t){const{station:e,className:a}=t,[s,r]=f.exports.useState([]),n=f.exports.useRef(!0),{db:i}=tt(),h=f.exports.useRef(null),c=f.exports.useRef(null);f.exports.useEffect(()=>()=>{n.current=!1,window.removeEventListener("resize",p)},[]);let m;const p=()=>{clearTimeout(m),m=setTimeout(u,500)};f.exports.useEffect(()=>{u(),window.addEventListener("resize",p)},[s]);const u=()=>{if(s.length==0||!h||!h.current||!c||!c.current)return;const v=Tt(s,{x:y=>y.ts,y:y=>y.tavg,cellSize:c.current.clientWidth/60,width:c.current.clientWidth-100});c.current.innerHTML="",c.current.appendChild(v);const b=Ft(v.scales.color,{title:"Daily average temperature",tickFormat:".0f"});h.current.innerHTML="",h.current.appendChild(b)};f.exports.useEffect(()=>{async function v(){if(!e)return;const b=e.getProperties();if(!b.hasOwnProperty("code"))return;const y=b.code;if(i){const d=await i.collection("observations").find({"source.code":parseInt(y,10)},{sort:{ts:-1}});n.current&&r(d)}}v()},[i]);let M;return s.length==0?M=qt:M=E("div",{className:"grid",children:[l("div",{className:"legend",ref:h}),l("div",{className:"calendar",ref:c})]}),l("div",{className:a,children:M})}function Vt(t){const{station:e,onClose:a}=t,s=()=>a();let r=l(kt,{});return e&&(r=l(Z,{open:!0,onClose:s,children:E("div",{className:"station-modal",children:[E("div",{className:"header",children:[l(A,{variant:"h6",children:e.getProperties().name}),l(_,{onClick:s,variant:"outlined",children:"Close"})]}),l(Bt,{className:"wrapper",station:e})]})})),r}var Ht="/mcc-frontend/assets/favicon.27019856.svg";function Wt(){const[t,e]=f.exports.useState(!1),a=()=>e(!0),s=()=>e(!1);return E(f.exports.Fragment,{children:[l("div",{className:"logo",title:"My city's climate",onClick:a,children:l("img",{src:Ht,alt:"My city's climate"})}),l(Z,{open:t,onClose:s,children:E(K,{className:"modal-logo-description",children:[l(A,{variant:"h6",component:"h2",children:"My city's climate"}),l(A,{sx:{mt:2},children:"Free online viewer for historical weather data"}),E(A,{sx:{mt:2},children:["The application uses ",l("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),E(A,{sx:{mt:2},children:["Source code - ",l("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),l(A,{align:"right",sx:{mt:2},children:l(_,{onClick:s,variant:"outlined",children:"Close"})})]})})]})}function Yt(){const{anonymousIn:t,user:e}=X(),{db:a}=tt(),[s,r]=f.exports.useState([]),[n,i]=f.exports.useState(null);f.exports.useEffect(()=>{async function m(){if(a){const p=await a.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});r(p)}}m()},[a]),f.exports.useEffect(()=>{e||t()});const h=m=>{m.length!=0&&i(m[0])},c=()=>{i(null)};return E(f.exports.Fragment,{children:[E("div",{className:"app",children:[l(Wt,{}),l(Gt,{stations:s,onClickFeatures:m=>h(m)})]}),l(Vt,{station:n,onClose:c})]})}Dt.render(l(k.StrictMode,{children:l($t,{children:l(Lt,{children:l(Yt,{})})})}),document.getElementById("root"));
