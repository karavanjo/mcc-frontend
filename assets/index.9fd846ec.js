var st=Object.defineProperty;var at=(t,e,r)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var O=(t,e,r)=>(at(t,typeof e!="symbol"?e+"":e,r),r);import{R as D,A as rt,r as y,j as c,C as G,S as $,a as k,F as R,b as L,c as ot,P as it,t as q,M as ct,T as lt,O as dt,V as ut,d as pt,e as ft,f as B,q as V,i as T,g as ht,h as N,k as W,l as Y,m as yt,n as mt,o as gt,p as xt,s as U,u as vt,v as H,w as wt,x as K,y as Ct,z as Mt,B as bt,D as St,E as Q,G as Et,H as _,I as b,J as P,K as J,L as Pt,N as At}from"./vendor.07db5aae.js";const Dt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};Dt();const X=D.createContext(null),Ot=({children:t})=>{const e="my-city-climate-pqkfg",r=new rt({id:e}),[a,s]=y.exports.useState(null),n=async()=>{const l=G.anonymous();try{return await r.logIn(l),s(r.currentUser),r.currentUser}catch{return s(null),null}},o=async(l,f)=>{const d=G.emailPassword(l,f);try{return await r.logIn(d),s(r.currentUser),r.currentUser}catch{return s(null),null}},h=()=>{var l;a!==null&&((l=r.currentUser)==null||l.logOut(),s(null))};return c(X.Provider,{value:{logIn:o,logOut:h,user:a,anonymousIn:n},children:t})},Z=()=>{const t=y.exports.useContext(X);if(t==null)throw new Error("useRealmApp() called outside of a RealmApp?");return t},z=D.createContext(null),$t=({children:t})=>{const{user:e}=Z(),[r,a]=y.exports.useState(null);return y.exports.useEffect(()=>{if(e!==null){const s=e.mongoClient("mongodb-atlas");a(s.db("mcc-climate"))}},[e]),c(z.Provider,{value:{db:r},children:t})},tt=()=>{const t=y.exports.useContext(z);if(t==null)throw new Error("useMongoDB() called outside of a MongoDB?");return t};const I={climate:new $({image:new k({radius:8,fill:new R({color:"#FC9292"}),stroke:new L({color:"#C86767",width:1})})}),perception:new $({image:new k({radius:3,fill:new R({color:"#c0ddff"}),stroke:new L({color:"#5f97dc",width:1})})}),synoptic:new $({image:new k({radius:5,fill:new R({color:"#d0ffc0"}),stroke:new L({color:"#74d350",width:1})})})},jt=t=>t.type=="k"?I.climate:t.type=="s"?I.synoptic:t.type=="pp"?I.perception:new $,kt=t=>{const e=[];return t.forEach(r=>{const a=new ot({geometry:new it(q(r.location.coordinates,"EPSG:4326","EPSG:3857")),name:r.name});a.type=r.type,a.setProperties({code:r.code,name:r.name,type:r.type}),e.push(a)}),e};function Rt(t){const e=y.exports.useRef(null);return y.exports.useEffect(()=>{const r=new ct({target:e.current,layers:[new lt({source:new dt})],view:new ut({projection:"EPSG:3857",center:q([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6}),controls:[]});t.onMapCreate&&t.onMapCreate(r)},[]),c("div",{ref:e,className:"map-container"})}var Lt=D.memo(Rt,(t,e)=>!0);class Nt extends D.Component{constructor(e){super(e);O(this,"map");O(this,"stationsLayer");O(this,"buildStationsLayer",()=>{if(!this.map)return;const e=this.map,r=kt(this.props.stations),a=new pt({source:new ft({features:r}),style:jt});e.addLayer(a),e.getView().fit(a.getSource().getExtent(),{padding:[50,50,50,50]}),e.on("pointermove",s=>{const n=e.getEventPixel(s.originalEvent),o=e.hasFeatureAtPixel(n);e.getViewport().style.cursor=o?"pointer":""}),e.on("click",s=>{const{onClickFeatures:n}=this.props;if(!n)return;const o=[];e.getEventPixel(s.originalEvent),e.forEachFeatureAtPixel(s.pixel,h=>o.push(h)),n(o)}),this.stationsLayer=a})}componentDidUpdate(e){e.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(e){this.map=e}render(){return c(Lt,{onMapCreate:e=>this.onMapCreate(e)})}}function Ut(t,{title:e,tickSize:r=6,width:a=320,height:s=44+r,marginTop:n=18,marginRight:o=0,marginBottom:h=16+r,marginLeft:l=0,ticks:f=a/64,tickFormat:d,tickValues:u}={}){function E(p,v=256){const m=document.createElement("canvas");m.width=v,m.height=1;const w=m.getContext("2d");for(let M=0;M<v;++M)w.fillStyle=p(M/(v-1)),w.fillRect(M,0,1,1);return m}const C=B("svg").attr("width",a).attr("height",s).attr("viewBox",[0,0,a,s]).style("overflow","visible").style("display","block");let A=p=>p.selectAll(".tick line").attr("y1",n+h-s),g;if(t.interpolate){const p=Math.min(t.domain().length,t.range().length);g=t.copy().rangeRound(V(T(l,a-o),p)),C.append("image").attr("x",l).attr("y",n).attr("width",a-l-o).attr("height",s-n-h).attr("preserveAspectRatio","none").attr("xlink:href",E(t.copy().domain(V(T(0,1),p))).toDataURL())}else if(t.interpolator){if(g=Object.assign(t.copy().interpolator(ht(l,a-o)),{range(){return[l,a-o]}}),C.append("image").attr("x",l).attr("y",n).attr("width",a-l-o).attr("height",s-n-h).attr("preserveAspectRatio","none").attr("xlink:href",E(t.interpolator()).toDataURL()),!g.ticks){if(u===void 0){const p=Math.round(f+1);u=N(p).map(v=>W(t.domain(),v/(p-1)))}typeof d!="function"&&(d=Y(d===void 0?",f":d))}}else if(t.invertExtent){const p=t.thresholds?t.thresholds():t.quantiles?t.quantiles():t.domain(),v=d===void 0?m=>m:typeof d=="string"?Y(d):d;g=yt().domain([-1,t.range().length-1]).rangeRound([l,a-o]),C.append("g").selectAll("rect").data(t.range()).join("rect").attr("x",(m,w)=>g(w-1)).attr("y",n).attr("width",(m,w)=>g(w)-g(w-1)).attr("height",s-n-h).attr("fill",m=>m),u=N(p.length),d=m=>v(p[m],m)}else g=mt().domain(t.domain()).rangeRound([l,a-o]),C.append("g").selectAll("rect").data(t.domain()).join("rect").attr("x",g).attr("y",n).attr("width",Math.max(0,g.bandwidth()-1)).attr("height",s-n-h).attr("fill",t),A=()=>{};return C.append("g").attr("transform",`translate(0,${s-h})`).call(gt(g).ticks(f,typeof d=="string"?d:void 0).tickFormat(typeof d=="function"?d:void 0).tickSize(r).tickValues(u)).call(A).call(p=>p.select(".domain").remove()).call(p=>p.append("text").attr("x",l).attr("y",n+h-s-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(e)),C.node()}function It(t,{x:e=([u])=>u,y:r=([,u])=>u,title:a,width:s=1e3,cellSize:n=12,weekday:o="monday",formatDay:h=u=>"SMTWTFS"[u],formatMonth:l="%b",yFormat:f,colors:d=xt}={}){const u=U(t,e),E=U(t,r),C=N(u.length),A=o==="sunday"?i=>i:i=>(i+6)%7,g=o==="sunday"?bt:St,p=o==="weekday"?5:7,v=n*(p+.2),m=W(E,.9975,Math.abs),w=vt([-m,+m],d).unknown("none");if(l=H(l),a===void 0){const i=H("%B %-d, %Y"),x=w.tickFormat(100,f);a=S=>`${i(u[S])}
${x(E[S])}`}else if(a!==null){const i=U(t,a);a=x=>i[x]}const M=wt(C,i=>u[i].getUTCFullYear()).reverse();function et(i){const x=Math.max(0,Math.min(p,A(i.getUTCDay()))),S=g.count(K(i),i);return`${x===0?`M${S*n},0`:x===p?`M${(S+1)*n},0`:`M${(S+1)*n},0V${x*n}H${S*n}`}V${p*n}`}const F=B("svg").attr("width",s).attr("height",v*M.length).attr("viewBox",[0,0,s,v*M.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size",15),j=F.selectAll("g").data(M).join("g").attr("id",(i,x)=>`mcc-year-${i[0]}`).attr("transform",(i,x)=>`translate(40.5,${v*x+n*1.5})`);j.append("text").attr("x",-5).attr("y",n*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([i])=>i);const nt=j.append("g").selectAll("rect").data(o==="weekday"?([,i])=>i.filter(x=>![0,6].includes(u[x].getUTCDay())):([,i])=>i).join("rect").attr("width",n-1).attr("height",n-1).attr("x",i=>g.count(K(u[i]),u[i])*n+.5).attr("y",i=>A(u[i].getUTCDay())*n+.5).attr("fill",i=>w(E[i]));return a&&nt.append("title").text(a),j.append("g").selectAll("g").data(([,i])=>Ct(Mt(u[i[0]]),u[i[i.length-1]])).join("g").filter((i,x)=>x).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",et),Object.assign(F.node(),{scales:{color:w}})}const Ft=c(Q,{sx:{width:"100%",marginTop:"10%"},children:c(Et,{})});function Gt(t){const{station:e,className:r}=t,[a,s]=y.exports.useState([]),{db:n}=tt(),o=y.exports.useRef(null);y.exports.useEffect(()=>{if(a.length==0||!o||!o.current)return;const l=It(a,{x:d=>d.ts,y:d=>d.tavg,cellSize:o.current.clientWidth/60,width:o.current.clientWidth-100}),f=Ut(l.scales.color,{title:"Daily average temperature",tickFormat:".0f"});o.current&&(o.current.appendChild(f),o.current.appendChild(l))},[a]),y.exports.useEffect(()=>{async function l(){if(!e)return;const f=e.getProperties();if(!f.hasOwnProperty("code"))return;const d=f.code;if(n){const u=await n.collection("observations").find({"source.code":parseInt(d,10)},{sort:{ts:-1}});s(u)}}l()},[n]);let h;return a.length==0?h=Ft:h=c("div",{className:"grid",ref:o}),c("div",{className:r,children:h})}function qt(t){const{station:e,onClose:r}=t,a=()=>r();let s=c(Pt,{});return e&&(s=c(_,{open:!0,onClose:a,children:b("div",{className:"station-modal",children:[b("div",{className:"header",children:[c(P,{variant:"h6",children:e.getProperties().name}),c(J,{onClick:a,variant:"outlined",children:"Close"})]}),c(Gt,{className:"wrapper",station:e})]})})),s}var Bt="/mcc-frontend/assets/favicon.27019856.svg";function Vt(){const[t,e]=y.exports.useState(!1),r=()=>e(!0),a=()=>e(!1);return b(y.exports.Fragment,{children:[c("div",{className:"logo",title:"My city's climate",onClick:r,children:c("img",{src:Bt,alt:"My city's climate"})}),c(_,{open:t,onClose:a,children:b(Q,{className:"modal-logo-description",children:[c(P,{variant:"h6",component:"h2",children:"My city's climate"}),c(P,{sx:{mt:2},children:"Free online viewer for historical weather data"}),b(P,{sx:{mt:2},children:["The application uses ",c("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),b(P,{sx:{mt:2},children:["Source code - ",c("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),c(P,{align:"right",sx:{mt:2},children:c(J,{onClick:a,variant:"outlined",children:"Close"})})]})})]})}function Tt(){const{anonymousIn:t,user:e}=Z(),{db:r}=tt(),[a,s]=y.exports.useState([]),[n,o]=y.exports.useState(null);y.exports.useEffect(()=>{async function f(){if(r){const d=await r.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});s(d)}}f()},[r]),y.exports.useEffect(()=>{e||t()});const h=f=>{f.length!=0&&o(f[0])},l=()=>{o(null)};return b(y.exports.Fragment,{children:[b("div",{className:"app",children:[c(Vt,{}),c(Nt,{stations:a,onClickFeatures:f=>h(f)})]}),c(qt,{station:n,onClose:l})]})}At.render(c(D.StrictMode,{children:c(Ot,{children:c($t,{children:c(Tt,{})})})}),document.getElementById("root"));
