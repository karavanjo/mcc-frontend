var st=Object.defineProperty;var rt=(t,e,a)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var O=(t,e,a)=>(rt(t,typeof e!="symbol"?e+"":e,a),a);import{R as D,A as at,r as h,j as l,C as G,S as $,a as R,F as k,b as L,c as ot,P as it,t as q,M as ct,T as lt,O as ut,V as dt,d as pt,e as ft,f as B,q as V,i as T,g as ht,h as N,k as W,l as Y,m as yt,n as mt,o as gt,p as xt,s as U,u as vt,v as H,w as wt,x as K,y as Ct,z as Mt,B as bt,D as Et,E as Q,G as St,H as _,I as E,J as P,K as J,L as Pt,N as At}from"./vendor.07db5aae.js";const Dt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}};Dt();const X=D.createContext(null),Ot=({children:t})=>{const e="my-city-climate-pqkfg",a=new at({id:e}),[r,n]=h.exports.useState(null),s=async()=>{const u=G.anonymous();try{return await a.logIn(u),n(a.currentUser),a.currentUser}catch{return n(null),null}},i=async(u,y)=>{const d=G.emailPassword(u,y);try{return await a.logIn(d),n(a.currentUser),a.currentUser}catch{return n(null),null}},p=()=>{var u;r!==null&&((u=a.currentUser)==null||u.logOut(),n(null))};return l(X.Provider,{value:{logIn:i,logOut:p,user:r,anonymousIn:s},children:t})},Z=()=>{const t=h.exports.useContext(X);if(t==null)throw new Error("useRealmApp() called outside of a RealmApp?");return t},z=D.createContext(null),$t=({children:t})=>{const{user:e}=Z(),[a,r]=h.exports.useState(null);return h.exports.useEffect(()=>{if(e!==null){const n=e.mongoClient("mongodb-atlas");r(n.db("mcc-climate"))}},[e]),l(z.Provider,{value:{db:a},children:t})},tt=()=>{const t=h.exports.useContext(z);if(t==null)throw new Error("useMongoDB() called outside of a MongoDB?");return t};const I={climate:new $({image:new R({radius:8,fill:new k({color:"#FC9292"}),stroke:new L({color:"#C86767",width:1})})}),perception:new $({image:new R({radius:3,fill:new k({color:"#c0ddff"}),stroke:new L({color:"#5f97dc",width:1})})}),synoptic:new $({image:new R({radius:5,fill:new k({color:"#d0ffc0"}),stroke:new L({color:"#74d350",width:1})})})},jt=t=>t.type=="k"?I.climate:t.type=="s"?I.synoptic:t.type=="pp"?I.perception:new $,Rt=t=>{const e=[];return t.forEach(a=>{const r=new ot({geometry:new it(q(a.location.coordinates,"EPSG:4326","EPSG:3857")),name:a.name});r.type=a.type,r.setProperties({code:a.code,name:a.name,type:a.type}),e.push(r)}),e};function kt(t){const e=h.exports.useRef(null);return h.exports.useEffect(()=>{const a=new ct({target:e.current,layers:[new lt({source:new ut})],view:new dt({projection:"EPSG:3857",center:q([19.105,52.107],"EPSG:4326","EPSG:3857"),zoom:6}),controls:[]});t.onMapCreate&&t.onMapCreate(a)},[]),l("div",{ref:e,className:"map-container"})}var Lt=D.memo(kt,(t,e)=>!0);class Nt extends D.Component{constructor(e){super(e);O(this,"map");O(this,"stationsLayer");O(this,"buildStationsLayer",()=>{if(!this.map)return;const e=this.map,a=Rt(this.props.stations),r=new pt({source:new ft({features:a}),style:jt});e.addLayer(r),e.getView().fit(r.getSource().getExtent(),{padding:[50,50,50,50]}),e.on("pointermove",n=>{const s=e.getEventPixel(n.originalEvent),i=e.hasFeatureAtPixel(s);e.getViewport().style.cursor=i?"pointer":""}),e.on("click",n=>{const{onClickFeatures:s}=this.props;if(!s)return;const i=[];e.getEventPixel(n.originalEvent),e.forEachFeatureAtPixel(n.pixel,p=>i.push(p)),s(i)}),this.stationsLayer=r})}componentDidUpdate(e){e.stations!==this.props.stations&&!this.stationsLayer&&this.map&&this.buildStationsLayer()}onMapCreate(e){this.map=e}render(){return l(Lt,{onMapCreate:e=>this.onMapCreate(e)})}}function Ut(t,{title:e,tickSize:a=6,width:r=320,height:n=44+a,marginTop:s=18,marginRight:i=0,marginBottom:p=16+a,marginLeft:u=0,ticks:y=r/64,tickFormat:d,tickValues:c}={}){function C(f,v=256){const m=document.createElement("canvas");m.width=v,m.height=1;const w=m.getContext("2d");for(let b=0;b<v;++b)w.fillStyle=f(b/(v-1)),w.fillRect(b,0,1,1);return m}const M=B("svg").attr("width",r).attr("height",n).attr("viewBox",[0,0,r,n]).style("overflow","visible").style("display","block");let A=f=>f.selectAll(".tick line").attr("y1",s+p-n),g;if(t.interpolate){const f=Math.min(t.domain().length,t.range().length);g=t.copy().rangeRound(V(T(u,r-i),f)),M.append("image").attr("x",u).attr("y",s).attr("width",r-u-i).attr("height",n-s-p).attr("preserveAspectRatio","none").attr("xlink:href",C(t.copy().domain(V(T(0,1),f))).toDataURL())}else if(t.interpolator){if(g=Object.assign(t.copy().interpolator(ht(u,r-i)),{range(){return[u,r-i]}}),M.append("image").attr("x",u).attr("y",s).attr("width",r-u-i).attr("height",n-s-p).attr("preserveAspectRatio","none").attr("xlink:href",C(t.interpolator()).toDataURL()),!g.ticks){if(c===void 0){const f=Math.round(y+1);c=N(f).map(v=>W(t.domain(),v/(f-1)))}typeof d!="function"&&(d=Y(d===void 0?",f":d))}}else if(t.invertExtent){const f=t.thresholds?t.thresholds():t.quantiles?t.quantiles():t.domain(),v=d===void 0?m=>m:typeof d=="string"?Y(d):d;g=yt().domain([-1,t.range().length-1]).rangeRound([u,r-i]),M.append("g").selectAll("rect").data(t.range()).join("rect").attr("x",(m,w)=>g(w-1)).attr("y",s).attr("width",(m,w)=>g(w)-g(w-1)).attr("height",n-s-p).attr("fill",m=>m),c=N(f.length),d=m=>v(f[m],m)}else g=mt().domain(t.domain()).rangeRound([u,r-i]),M.append("g").selectAll("rect").data(t.domain()).join("rect").attr("x",g).attr("y",s).attr("width",Math.max(0,g.bandwidth()-1)).attr("height",n-s-p).attr("fill",t),A=()=>{};return M.append("g").attr("transform",`translate(0,${n-p})`).call(gt(g).ticks(y,typeof d=="string"?d:void 0).tickFormat(typeof d=="function"?d:void 0).tickSize(a).tickValues(c)).call(A).call(f=>f.select(".domain").remove()).call(f=>f.append("text").attr("x",u).attr("y",s+p-n-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(e)),M.node()}function It(t,{x:e=([c])=>c,y:a=([,c])=>c,title:r,width:n=1e3,cellSize:s=12,weekday:i="monday",formatDay:p=c=>"SMTWTFS"[c],formatMonth:u="%b",yFormat:y,colors:d=xt}={}){const c=U(t,e),C=U(t,a),M=N(c.length),A=i==="sunday"?o=>o:o=>(o+6)%7,g=i==="sunday"?bt:Et,f=i==="weekday"?5:7,v=s*(f+.2);n=s*58;const m=W(C,.9975,Math.abs),w=vt([-m,+m],d).unknown("none");if(u=H(u),r===void 0){const o=H("%B %-d, %Y"),x=w.tickFormat(100,y);r=S=>`${o(c[S])}
${x(C[S])}`}else if(r!==null){const o=U(t,r);r=x=>o[x]}const b=wt(M,o=>c[o].getUTCFullYear()).reverse();function et(o){const x=Math.max(0,Math.min(f,A(o.getUTCDay()))),S=g.count(K(o),o);return`${x===0?`M${S*s},0`:x===f?`M${(S+1)*s},0`:`M${(S+1)*s},0V${x*s}H${S*s}`}V${f*s}`}const F=B("svg").attr("width",n).attr("height",v*b.length).attr("viewBox",[0,0,n,v*b.length]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size",15),j=F.selectAll("g").data(b).join("g").attr("id",(o,x)=>`mcc-year-${o[0]}`).attr("transform",(o,x)=>`translate(40.5,${v*x+s*1.5})`);j.append("text").attr("x",-5).attr("y",s*3.5).attr("font-weight","bold").attr("text-anchor","end").text(([o])=>o);const nt=j.append("g").selectAll("rect").data(i==="weekday"?([,o])=>o.filter(x=>![0,6].includes(c[x].getUTCDay())):([,o])=>o).join("rect").attr("width",s-1).attr("height",s-1).attr("x",o=>g.count(K(c[o]),c[o])*s+.5).attr("y",o=>A(c[o].getUTCDay())*s+.5).attr("fill",o=>w(C[o]));return r&&nt.append("title").text(r),j.append("g").selectAll("g").data(([,o])=>Ct(Mt(c[o[0]]),c[o[o.length-1]])).join("g").filter((o,x)=>x).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",et),Object.assign(F.node(),{scales:{color:w}})}const Ft=l(Q,{sx:{width:"100%",marginTop:"10%"},children:l(St,{})});function Gt(t){const{station:e,className:a}=t,[r,n]=h.exports.useState([]),s=h.exports.useRef(!0),{db:i}=tt(),p=h.exports.useRef(null);h.exports.useEffect(()=>()=>{s.current=!1},[]),h.exports.useEffect(()=>{if(r.length==0||!p||!p.current)return;const y=It(r,{x:c=>c.ts,y:c=>c.tavg,cellSize:p.current.clientWidth/60,width:p.current.clientWidth-100}),d=Ut(y.scales.color,{title:"Daily average temperature",tickFormat:".0f"});p.current&&(p.current.appendChild(d),p.current.appendChild(y)),window.addEventListener("resize",function(c){console.log(c.detail)})},[r]),h.exports.useEffect(()=>{async function y(){if(!e)return;const d=e.getProperties();if(!d.hasOwnProperty("code"))return;const c=d.code;if(i){const C=await i.collection("observations").find({"source.code":parseInt(c,10)},{sort:{ts:-1}});s.current&&n(C)}}y()},[i]);let u;return r.length==0?u=Ft:u=l("div",{className:"grid",ref:p}),l("div",{className:a,children:u})}function qt(t){const{station:e,onClose:a}=t,r=()=>a();let n=l(Pt,{});return e&&(n=l(_,{open:!0,onClose:r,children:E("div",{className:"station-modal",children:[E("div",{className:"header",children:[l(P,{variant:"h6",children:e.getProperties().name}),l(J,{onClick:r,variant:"outlined",children:"Close"})]}),l(Gt,{className:"wrapper",station:e})]})})),n}var Bt="/mcc-frontend/assets/favicon.27019856.svg";function Vt(){const[t,e]=h.exports.useState(!1),a=()=>e(!0),r=()=>e(!1);return E(h.exports.Fragment,{children:[l("div",{className:"logo",title:"My city's climate",onClick:a,children:l("img",{src:Bt,alt:"My city's climate"})}),l(_,{open:t,onClose:r,children:E(Q,{className:"modal-logo-description",children:[l(P,{variant:"h6",component:"h2",children:"My city's climate"}),l(P,{sx:{mt:2},children:"Free online viewer for historical weather data"}),E(P,{sx:{mt:2},children:["The application uses ",l("a",{href:"https://danepubliczne.imgw.pl/",children:"Dane publiczne IMGW-PIB"})]}),E(P,{sx:{mt:2},children:["Source code - ",l("a",{href:"https://github.com/karavanjo/mcc-frontend",title:"karavanjo/mcc-frontend",children:"github"})]}),l(P,{align:"right",sx:{mt:2},children:l(J,{onClick:r,variant:"outlined",children:"Close"})})]})})]})}function Tt(){const{anonymousIn:t,user:e}=Z(),{db:a}=tt(),[r,n]=h.exports.useState([]),[s,i]=h.exports.useState(null);h.exports.useEffect(()=>{async function y(){if(a){const d=await a.collection("stations").find({},{projection:{code:1,name:1,type:1,location:1}});n(d)}}y()},[a]),h.exports.useEffect(()=>{e||t()});const p=y=>{y.length!=0&&i(y[0])},u=()=>{i(null)};return E(h.exports.Fragment,{children:[E("div",{className:"app",children:[l(Vt,{}),l(Nt,{stations:r,onClickFeatures:y=>p(y)})]}),l(qt,{station:s,onClose:u})]})}At.render(l(D.StrictMode,{children:l(Ot,{children:l($t,{children:l(Tt,{})})})}),document.getElementById("root"));
